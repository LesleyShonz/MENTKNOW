{"ast":null,"code":"import _slicedToArray from \"/Users/lesleyshinhiwa/Downloads/tldraw-partykit-example-2/Co/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _classCallCheck from \"/Users/lesleyshinhiwa/Downloads/tldraw-partykit-example-2/Co/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/lesleyshinhiwa/Downloads/tldraw-partykit-example-2/Co/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _assertThisInitialized from \"/Users/lesleyshinhiwa/Downloads/tldraw-partykit-example-2/Co/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";\nimport _inherits from \"/Users/lesleyshinhiwa/Downloads/tldraw-partykit-example-2/Co/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/lesleyshinhiwa/Downloads/tldraw-partykit-example-2/Co/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport _defineProperty from \"/Users/lesleyshinhiwa/Downloads/tldraw-partykit-example-2/Co/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _regeneratorRuntime from \"/Users/lesleyshinhiwa/Downloads/tldraw-partykit-example-2/Co/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/lesleyshinhiwa/Downloads/tldraw-partykit-example-2/Co/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { Fragment, jsx, jsxs } from \"react/jsx-runtime\";\nimport { Vec2d, toDomPrecision } from \"@tldraw/primitives\";\nimport { deepCopy } from \"@tldraw/utils\";\nimport { useEffect, useState } from \"react\";\nimport { useValue } from \"signia-react\";\nimport { DefaultSpinner } from \"../../../components/DefaultSpinner.mjs\";\nimport { HTMLContainer } from \"../../../components/HTMLContainer.mjs\";\nimport { useIsCropping } from \"../../../hooks/useIsCropping.mjs\";\nimport { usePrefersReducedMotion } from \"../../../utils/dom.mjs\";\nimport { BaseBoxShapeUtil } from \"../BaseBoxShapeUtil.mjs\";\nimport { HyperlinkButton } from \"../shared/HyperlinkButton.mjs\";\nvar loadImage = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(url) {\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          return _context.abrupt(\"return\", new Promise(function (resolve, reject) {\n            var image = new Image();\n            image.onload = function () {\n              return resolve(image);\n            };\n            image.onerror = function () {\n              return reject(new Error(\"Failed to load image\"));\n            };\n            image.crossOrigin = \"anonymous\";\n            image.src = url;\n          }));\n        case 1:\n        case \"end\":\n          return _context.stop();\n      }\n    }, _callee);\n  }));\n  return function loadImage(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\nvar getStateFrame = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(url) {\n    var image, canvas, ctx;\n    return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return loadImage(url);\n        case 2:\n          image = _context2.sent;\n          canvas = document.createElement(\"canvas\");\n          canvas.width = image.width;\n          canvas.height = image.height;\n          ctx = canvas.getContext(\"2d\");\n          if (ctx) {\n            _context2.next = 9;\n            break;\n          }\n          return _context2.abrupt(\"return\");\n        case 9:\n          ctx.drawImage(image, 0, 0);\n          return _context2.abrupt(\"return\", canvas.toDataURL());\n        case 11:\n        case \"end\":\n          return _context2.stop();\n      }\n    }, _callee2);\n  }));\n  return function getStateFrame(_x2) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nfunction getDataURIFromURL(_x3) {\n  return _getDataURIFromURL.apply(this, arguments);\n}\nfunction _getDataURIFromURL() {\n  _getDataURIFromURL = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5(url) {\n    var response, blob;\n    return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n      while (1) switch (_context5.prev = _context5.next) {\n        case 0:\n          _context5.next = 2;\n          return fetch(url);\n        case 2:\n          response = _context5.sent;\n          _context5.next = 5;\n          return response.blob();\n        case 5:\n          blob = _context5.sent;\n          return _context5.abrupt(\"return\", new Promise(function (resolve, reject) {\n            var reader = new FileReader();\n            reader.onloadend = function () {\n              return resolve(reader.result);\n            };\n            reader.onerror = reject;\n            reader.readAsDataURL(blob);\n          }));\n        case 7:\n        case \"end\":\n          return _context5.stop();\n      }\n    }, _callee5);\n  }));\n  return _getDataURIFromURL.apply(this, arguments);\n}\nvar ImageShapeUtil = /*#__PURE__*/function (_BaseBoxShapeUtil) {\n  _inherits(ImageShapeUtil, _BaseBoxShapeUtil);\n  var _super = _createSuper(ImageShapeUtil);\n  function ImageShapeUtil() {\n    var _this;\n    _classCallCheck(this, ImageShapeUtil);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _super.call.apply(_super, [this].concat(args));\n    _defineProperty(_assertThisInitialized(_this), \"isAspectRatioLocked\", function () {\n      return true;\n    });\n    _defineProperty(_assertThisInitialized(_this), \"canCrop\", function () {\n      return true;\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onDoubleClick\", function (shape) {\n      var asset = shape.props.assetId ? _this.editor.getAssetById(shape.props.assetId) : void 0;\n      if (!asset) return;\n      var canPlay = asset.props.src && \"mimeType\" in asset.props && asset.props.mimeType === \"image/gif\";\n      if (!canPlay) return;\n      _this.editor.updateShapes([{\n        type: \"image\",\n        id: shape.id,\n        props: {\n          playing: !shape.props.playing\n        }\n      }]);\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onDoubleClickEdge\", function (shape) {\n      var props = shape.props;\n      if (!props) return;\n      if (_this.editor.croppingId !== shape.id) {\n        return;\n      }\n      var crop = deepCopy(props.crop) || {\n        topLeft: {\n          x: 0,\n          y: 0\n        },\n        bottomRight: {\n          x: 1,\n          y: 1\n        }\n      };\n      var w = 1 / (crop.bottomRight.x - crop.topLeft.x) * shape.props.w;\n      var h = 1 / (crop.bottomRight.y - crop.topLeft.y) * shape.props.h;\n      var pointDelta = new Vec2d(crop.topLeft.x * w, crop.topLeft.y * h).rot(shape.rotation);\n      var partial = {\n        id: shape.id,\n        type: shape.type,\n        x: shape.x - pointDelta.x,\n        y: shape.y - pointDelta.y,\n        props: {\n          crop: {\n            topLeft: {\n              x: 0,\n              y: 0\n            },\n            bottomRight: {\n              x: 1,\n              y: 1\n            }\n          },\n          w: w,\n          h: h\n        }\n      };\n      _this.editor.updateShapes([partial]);\n    });\n    return _this;\n  }\n  _createClass(ImageShapeUtil, [{\n    key: \"defaultProps\",\n    value: function defaultProps() {\n      return {\n        w: 100,\n        h: 100,\n        assetId: null,\n        playing: true,\n        url: \"\",\n        crop: null\n      };\n    }\n  }, {\n    key: \"component\",\n    value: function component(shape) {\n      var _this2 = this,\n        _asset$props$mimeType,\n        _asset$props$mimeType2;\n      var containerStyle = getContainerStyle(shape);\n      var isCropping = useIsCropping(shape.id);\n      var prefersReducedMotion = usePrefersReducedMotion();\n      var _useState = useState(\"\"),\n        _useState2 = _slicedToArray(_useState, 2),\n        staticFrameSrc = _useState2[0],\n        setStaticFrameSrc = _useState2[1];\n      var _shape$props = shape.props,\n        w = _shape$props.w,\n        h = _shape$props.h;\n      var asset = shape.props.assetId ? this.editor.getAssetById(shape.props.assetId) : void 0;\n      if ((asset === null || asset === void 0 ? void 0 : asset.type) === \"bookmark\") {\n        throw Error(\"Bookmark assets can't be rendered as images\");\n      }\n      var isSelected = useValue(\"onlySelectedShape\", function () {\n        var _this2$editor$onlySel;\n        return shape.id === ((_this2$editor$onlySel = _this2.editor.onlySelectedShape) === null || _this2$editor$onlySel === void 0 ? void 0 : _this2$editor$onlySel.id);\n      }, [this.editor]);\n      var showCropPreview = isSelected && isCropping && this.editor.isInAny(\"select.crop\", \"select.cropping\", \"select.pointing_crop_handle\");\n      var reduceMotion = prefersReducedMotion && ((asset === null || asset === void 0 || (_asset$props$mimeType = asset.props.mimeType) === null || _asset$props$mimeType === void 0 ? void 0 : _asset$props$mimeType.includes(\"video\")) || (asset === null || asset === void 0 || (_asset$props$mimeType2 = asset.props.mimeType) === null || _asset$props$mimeType2 === void 0 ? void 0 : _asset$props$mimeType2.includes(\"gif\")));\n      useEffect(function () {\n        if (asset !== null && asset !== void 0 && asset.props.src && \"mimeType\" in asset.props && (asset === null || asset === void 0 ? void 0 : asset.props.mimeType) === \"image/gif\") {\n          var cancelled = false;\n          var run = /*#__PURE__*/function () {\n            var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n              var newStaticFrame;\n              return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n                while (1) switch (_context3.prev = _context3.next) {\n                  case 0:\n                    _context3.next = 2;\n                    return getStateFrame(asset.props.src);\n                  case 2:\n                    newStaticFrame = _context3.sent;\n                    if (!cancelled) {\n                      _context3.next = 5;\n                      break;\n                    }\n                    return _context3.abrupt(\"return\");\n                  case 5:\n                    if (newStaticFrame) {\n                      setStaticFrameSrc(newStaticFrame);\n                    }\n                  case 6:\n                  case \"end\":\n                    return _context3.stop();\n                }\n              }, _callee3);\n            }));\n            return function run() {\n              return _ref3.apply(this, arguments);\n            };\n          }();\n          run();\n          return function () {\n            cancelled = true;\n          };\n        }\n      }, [prefersReducedMotion, asset === null || asset === void 0 ? void 0 : asset.props]);\n      return /* @__PURE__ */jsxs(Fragment, {\n        children: [(asset === null || asset === void 0 ? void 0 : asset.props.src) && showCropPreview && /* @__PURE__ */jsx(\"div\", {\n          style: containerStyle,\n          children: /* @__PURE__ */jsx(\"div\", {\n            className: \"tl-image tl-image-\".concat(shape.id, \"-crop\"),\n            style: {\n              opacity: 0.1,\n              backgroundImage: \"url(\".concat(!shape.props.playing || reduceMotion ? staticFrameSrc : asset.props.src, \")\")\n            },\n            draggable: false\n          })\n        }), /* @__PURE__ */jsx(HTMLContainer, {\n          id: shape.id,\n          style: {\n            overflow: \"hidden\"\n          },\n          children: /* @__PURE__ */jsxs(\"div\", {\n            className: \"tl-image-container\",\n            style: containerStyle,\n            children: [asset !== null && asset !== void 0 && asset.props.src ? /* @__PURE__ */jsx(\"div\", {\n              className: \"tl-image tl-image-\".concat(shape.id),\n              style: {\n                backgroundImage: \"url(\".concat(!shape.props.playing || reduceMotion ? staticFrameSrc : asset.props.src, \")\")\n              },\n              draggable: false\n            }) : /* @__PURE__ */jsx(\"g\", {\n              transform: \"translate(\".concat((w - 38) / 2, \", \").concat((h - 38) / 2, \")\"),\n              children: /* @__PURE__ */jsx(DefaultSpinner, {})\n            }), (asset === null || asset === void 0 ? void 0 : asset.props.isAnimated) && !shape.props.playing && /* @__PURE__ */jsx(\"div\", {\n              className: \"tl-image__tg\",\n              children: \"GIF\"\n            })]\n          })\n        }), \"url\" in shape.props && shape.props.url && /* @__PURE__ */jsx(HyperlinkButton, {\n          url: shape.props.url,\n          zoomLevel: this.editor.zoomLevel\n        })]\n      });\n    }\n  }, {\n    key: \"indicator\",\n    value: function indicator(shape) {\n      var isCropping = useIsCropping(shape.id);\n      if (isCropping) {\n        return null;\n      }\n      return /* @__PURE__ */jsx(\"rect\", {\n        width: toDomPrecision(shape.props.w),\n        height: toDomPrecision(shape.props.h)\n      });\n    }\n  }, {\n    key: \"toSvg\",\n    value: function () {\n      var _toSvg = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4(shape) {\n        var g, asset, src, image, containerStyle, crop, transform, width, height, points, innerElement;\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              g = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\n              asset = shape.props.assetId ? this.editor.getAssetById(shape.props.assetId) : null;\n              src = (asset === null || asset === void 0 ? void 0 : asset.props.src) || \"\";\n              if (!(src && src.startsWith(\"http\"))) {\n                _context4.next = 10;\n                break;\n              }\n              _context4.next = 6;\n              return getDataURIFromURL(src);\n            case 6:\n              _context4.t0 = _context4.sent;\n              if (_context4.t0) {\n                _context4.next = 9;\n                break;\n              }\n              _context4.t0 = \"\";\n            case 9:\n              src = _context4.t0;\n            case 10:\n              image = document.createElementNS(\"http://www.w3.org/2000/svg\", \"image\");\n              image.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"href\", src);\n              containerStyle = getContainerStyle(shape);\n              crop = shape.props.crop;\n              if (containerStyle && crop) {\n                transform = containerStyle.transform, width = containerStyle.width, height = containerStyle.height;\n                points = [new Vec2d(crop.topLeft.x * width, crop.topLeft.y * height), new Vec2d(crop.bottomRight.x * width, crop.topLeft.y * height), new Vec2d(crop.bottomRight.x * width, crop.bottomRight.y * height), new Vec2d(crop.topLeft.x * width, crop.bottomRight.y * height)];\n                innerElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\n                innerElement.style.clipPath = \"polygon(\".concat(points.map(function (p) {\n                  return \"\".concat(p.x, \"px \").concat(p.y, \"px\");\n                }).join(\",\"), \")\");\n                image.setAttribute(\"width\", width.toString());\n                image.setAttribute(\"height\", height.toString());\n                image.style.transform = transform;\n                innerElement.appendChild(image);\n                g.appendChild(innerElement);\n              } else {\n                image.setAttribute(\"width\", shape.props.w.toString());\n                image.setAttribute(\"height\", shape.props.h.toString());\n                g.appendChild(image);\n              }\n              return _context4.abrupt(\"return\", g);\n            case 16:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4, this);\n      }));\n      function toSvg(_x4) {\n        return _toSvg.apply(this, arguments);\n      }\n      return toSvg;\n    }()\n  }]);\n  return ImageShapeUtil;\n}(BaseBoxShapeUtil);\n_defineProperty(ImageShapeUtil, \"type\", \"image\");\nfunction getContainerStyle(shape) {\n  var crop = shape.props.crop;\n  var topLeft = crop === null || crop === void 0 ? void 0 : crop.topLeft;\n  if (!topLeft) return;\n  var w = 1 / (crop.bottomRight.x - crop.topLeft.x) * shape.props.w;\n  var h = 1 / (crop.bottomRight.y - crop.topLeft.y) * shape.props.h;\n  var offsetX = -topLeft.x * w;\n  var offsetY = -topLeft.y * h;\n  return {\n    transform: \"translate(\".concat(offsetX, \"px, \").concat(offsetY, \"px)\"),\n    width: w,\n    height: h\n  };\n}\nexport { ImageShapeUtil };","map":{"version":3,"names":["Fragment","jsx","jsxs","Vec2d","toDomPrecision","deepCopy","useEffect","useState","useValue","DefaultSpinner","HTMLContainer","useIsCropping","usePrefersReducedMotion","BaseBoxShapeUtil","HyperlinkButton","loadImage","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","url","wrap","_callee$","_context","prev","next","abrupt","Promise","resolve","reject","image","Image","onload","onerror","Error","crossOrigin","src","stop","_x","apply","arguments","getStateFrame","_ref2","_callee2","canvas","ctx","_callee2$","_context2","sent","document","createElement","width","height","getContext","drawImage","toDataURL","_x2","getDataURIFromURL","_x3","_getDataURIFromURL","_callee5","response","blob","_callee5$","_context5","fetch","reader","FileReader","onloadend","result","readAsDataURL","ImageShapeUtil","_BaseBoxShapeUtil","_inherits","_super","_createSuper","_this","_classCallCheck","_len","length","args","Array","_key","call","concat","_defineProperty","_assertThisInitialized","shape","asset","props","assetId","editor","getAssetById","canPlay","mimeType","updateShapes","type","id","playing","croppingId","crop","topLeft","x","y","bottomRight","w","h","pointDelta","rot","rotation","partial","_createClass","key","value","defaultProps","component","_this2","_asset$props$mimeType","_asset$props$mimeType2","containerStyle","getContainerStyle","isCropping","prefersReducedMotion","_useState","_useState2","_slicedToArray","staticFrameSrc","setStaticFrameSrc","_shape$props","isSelected","_this2$editor$onlySel","onlySelectedShape","showCropPreview","isInAny","reduceMotion","includes","cancelled","run","_ref3","_callee3","newStaticFrame","_callee3$","_context3","children","style","className","opacity","backgroundImage","draggable","overflow","transform","isAnimated","zoomLevel","indicator","_toSvg","_callee4","g","points","innerElement","_callee4$","_context4","createElementNS","startsWith","t0","setAttributeNS","clipPath","map","p","join","setAttribute","toString","appendChild","toSvg","_x4","offsetX","offsetY"],"sources":["/Users/lesleyshinhiwa/Downloads/tldraw-partykit-example-2/Co/node_modules/@tldraw/editor/src/lib/editor/shapes/image/ImageShapeUtil.tsx"],"sourcesContent":["/* eslint-disable react-hooks/rules-of-hooks */\nimport { Vec2d, toDomPrecision } from '@tldraw/primitives'\nimport { TLImageShape, TLShapePartial } from '@tldraw/tlschema'\nimport { deepCopy } from '@tldraw/utils'\nimport { useEffect, useState } from 'react'\nimport { useValue } from 'signia-react'\nimport { DefaultSpinner } from '../../../components/DefaultSpinner'\nimport { HTMLContainer } from '../../../components/HTMLContainer'\nimport { useIsCropping } from '../../../hooks/useIsCropping'\nimport { usePrefersReducedMotion } from '../../../utils/dom'\nimport { BaseBoxShapeUtil } from '../BaseBoxShapeUtil'\nimport { TLOnDoubleClickHandler } from '../ShapeUtil'\nimport { HyperlinkButton } from '../shared/HyperlinkButton'\n\nconst loadImage = async (url: string): Promise<HTMLImageElement> => {\n\treturn new Promise((resolve, reject) => {\n\t\tconst image = new Image()\n\t\timage.onload = () => resolve(image)\n\t\timage.onerror = () => reject(new Error('Failed to load image'))\n\t\timage.crossOrigin = 'anonymous'\n\t\timage.src = url\n\t})\n}\n\nconst getStateFrame = async (url: string) => {\n\tconst image = await loadImage(url)\n\n\tconst canvas = document.createElement('canvas')\n\tcanvas.width = image.width\n\tcanvas.height = image.height\n\n\tconst ctx = canvas.getContext('2d')\n\tif (!ctx) return\n\n\tctx.drawImage(image, 0, 0)\n\treturn canvas.toDataURL()\n}\n\nasync function getDataURIFromURL(url: string): Promise<string> {\n\tconst response = await fetch(url)\n\tconst blob = await response.blob()\n\treturn new Promise((resolve, reject) => {\n\t\tconst reader = new FileReader()\n\t\treader.onloadend = () => resolve(reader.result as string)\n\t\treader.onerror = reject\n\t\treader.readAsDataURL(blob)\n\t})\n}\n\n/** @public */\nexport class ImageShapeUtil extends BaseBoxShapeUtil<TLImageShape> {\n\tstatic override type = 'image' as const\n\n\toverride isAspectRatioLocked = () => true\n\toverride canCrop = () => true\n\n\toverride defaultProps(): TLImageShape['props'] {\n\t\treturn {\n\t\t\tw: 100,\n\t\t\th: 100,\n\t\t\tassetId: null,\n\t\t\tplaying: true,\n\t\t\turl: '',\n\t\t\tcrop: null,\n\t\t}\n\t}\n\n\tcomponent(shape: TLImageShape) {\n\t\tconst containerStyle = getContainerStyle(shape)\n\t\tconst isCropping = useIsCropping(shape.id)\n\t\tconst prefersReducedMotion = usePrefersReducedMotion()\n\t\tconst [staticFrameSrc, setStaticFrameSrc] = useState('')\n\n\t\tconst { w, h } = shape.props\n\t\tconst asset = shape.props.assetId ? this.editor.getAssetById(shape.props.assetId) : undefined\n\n\t\tif (asset?.type === 'bookmark') {\n\t\t\tthrow Error(\"Bookmark assets can't be rendered as images\")\n\t\t}\n\n\t\tconst isSelected = useValue(\n\t\t\t'onlySelectedShape',\n\t\t\t() => shape.id === this.editor.onlySelectedShape?.id,\n\t\t\t[this.editor]\n\t\t)\n\n\t\tconst showCropPreview =\n\t\t\tisSelected &&\n\t\t\tisCropping &&\n\t\t\tthis.editor.isInAny('select.crop', 'select.cropping', 'select.pointing_crop_handle')\n\n\t\t// We only want to reduce motion for mimeTypes that have motion\n\t\tconst reduceMotion =\n\t\t\tprefersReducedMotion &&\n\t\t\t(asset?.props.mimeType?.includes('video') || asset?.props.mimeType?.includes('gif'))\n\n\t\tuseEffect(() => {\n\t\t\tif (asset?.props.src && 'mimeType' in asset.props && asset?.props.mimeType === 'image/gif') {\n\t\t\t\tlet cancelled = false\n\t\t\t\tconst run = async () => {\n\t\t\t\t\tconst newStaticFrame = await getStateFrame(asset.props.src!)\n\t\t\t\t\tif (cancelled) return\n\t\t\t\t\tif (newStaticFrame) {\n\t\t\t\t\t\tsetStaticFrameSrc(newStaticFrame)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\trun()\n\n\t\t\t\treturn () => {\n\t\t\t\t\tcancelled = true\n\t\t\t\t}\n\t\t\t}\n\t\t}, [prefersReducedMotion, asset?.props])\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t{asset?.props.src && showCropPreview && (\n\t\t\t\t\t<div style={containerStyle}>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName={`tl-image tl-image-${shape.id}-crop`}\n\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\topacity: 0.1,\n\t\t\t\t\t\t\t\tbackgroundImage: `url(${\n\t\t\t\t\t\t\t\t\t!shape.props.playing || reduceMotion ? staticFrameSrc : asset.props.src\n\t\t\t\t\t\t\t\t})`,\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tdraggable={false}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t\t<HTMLContainer id={shape.id} style={{ overflow: 'hidden' }}>\n\t\t\t\t\t<div className=\"tl-image-container\" style={containerStyle}>\n\t\t\t\t\t\t{asset?.props.src ? (\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclassName={`tl-image tl-image-${shape.id}`}\n\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\tbackgroundImage: `url(${\n\t\t\t\t\t\t\t\t\t\t!shape.props.playing || reduceMotion ? staticFrameSrc : asset.props.src\n\t\t\t\t\t\t\t\t\t})`,\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tdraggable={false}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<g transform={`translate(${(w - 38) / 2}, ${(h - 38) / 2})`}>\n\t\t\t\t\t\t\t\t<DefaultSpinner />\n\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t{asset?.props.isAnimated && !shape.props.playing && (\n\t\t\t\t\t\t\t<div className=\"tl-image__tg\">GIF</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</HTMLContainer>\n\t\t\t\t{'url' in shape.props && shape.props.url && (\n\t\t\t\t\t<HyperlinkButton url={shape.props.url} zoomLevel={this.editor.zoomLevel} />\n\t\t\t\t)}\n\t\t\t</>\n\t\t)\n\t}\n\n\tindicator(shape: TLImageShape) {\n\t\tconst isCropping = useIsCropping(shape.id)\n\t\tif (isCropping) {\n\t\t\treturn null\n\t\t}\n\t\treturn <rect width={toDomPrecision(shape.props.w)} height={toDomPrecision(shape.props.h)} />\n\t}\n\n\tasync toSvg(shape: TLImageShape) {\n\t\tconst g = document.createElementNS('http://www.w3.org/2000/svg', 'g')\n\t\tconst asset = shape.props.assetId ? this.editor.getAssetById(shape.props.assetId) : null\n\n\t\tlet src = asset?.props.src || ''\n\t\tif (src && src.startsWith('http')) {\n\t\t\t// If it's a remote image, we need to fetch it and convert it to a data URI\n\t\t\tsrc = (await getDataURIFromURL(src)) || ''\n\t\t}\n\n\t\tconst image = document.createElementNS('http://www.w3.org/2000/svg', 'image')\n\t\timage.setAttributeNS('http://www.w3.org/1999/xlink', 'href', src)\n\t\tconst containerStyle = getContainerStyle(shape)\n\t\tconst crop = shape.props.crop\n\t\tif (containerStyle && crop) {\n\t\t\tconst { transform, width, height } = containerStyle\n\t\t\tconst points = [\n\t\t\t\tnew Vec2d(crop.topLeft.x * width, crop.topLeft.y * height),\n\t\t\t\tnew Vec2d(crop.bottomRight.x * width, crop.topLeft.y * height),\n\t\t\t\tnew Vec2d(crop.bottomRight.x * width, crop.bottomRight.y * height),\n\t\t\t\tnew Vec2d(crop.topLeft.x * width, crop.bottomRight.y * height),\n\t\t\t]\n\t\t\tconst innerElement = document.createElementNS('http://www.w3.org/2000/svg', 'g')\n\t\t\tinnerElement.style.clipPath = `polygon(${points.map((p) => `${p.x}px ${p.y}px`).join(',')})`\n\t\t\timage.setAttribute('width', width.toString())\n\t\t\timage.setAttribute('height', height.toString())\n\t\t\timage.style.transform = transform\n\t\t\tinnerElement.appendChild(image)\n\t\t\tg.appendChild(innerElement)\n\t\t} else {\n\t\t\timage.setAttribute('width', shape.props.w.toString())\n\t\t\timage.setAttribute('height', shape.props.h.toString())\n\t\t\tg.appendChild(image)\n\t\t}\n\n\t\treturn g\n\t}\n\n\tonDoubleClick = (shape: TLImageShape) => {\n\t\tconst asset = shape.props.assetId ? this.editor.getAssetById(shape.props.assetId) : undefined\n\n\t\tif (!asset) return\n\n\t\tconst canPlay =\n\t\t\tasset.props.src && 'mimeType' in asset.props && asset.props.mimeType === 'image/gif'\n\n\t\tif (!canPlay) return\n\n\t\tthis.editor.updateShapes([\n\t\t\t{\n\t\t\t\ttype: 'image',\n\t\t\t\tid: shape.id,\n\t\t\t\tprops: {\n\t\t\t\t\tplaying: !shape.props.playing,\n\t\t\t\t},\n\t\t\t},\n\t\t])\n\t}\n\n\tonDoubleClickEdge: TLOnDoubleClickHandler<TLImageShape> = (shape) => {\n\t\tconst props = shape.props\n\t\tif (!props) return\n\n\t\tif (this.editor.croppingId !== shape.id) {\n\t\t\treturn\n\t\t}\n\n\t\tconst crop = deepCopy(props.crop) || {\n\t\t\ttopLeft: { x: 0, y: 0 },\n\t\t\tbottomRight: { x: 1, y: 1 },\n\t\t}\n\n\t\t// The true asset dimensions\n\t\tconst w = (1 / (crop.bottomRight.x - crop.topLeft.x)) * shape.props.w\n\t\tconst h = (1 / (crop.bottomRight.y - crop.topLeft.y)) * shape.props.h\n\n\t\tconst pointDelta = new Vec2d(crop.topLeft.x * w, crop.topLeft.y * h).rot(shape.rotation)\n\n\t\tconst partial: TLShapePartial<TLImageShape> = {\n\t\t\tid: shape.id,\n\t\t\ttype: shape.type,\n\t\t\tx: shape.x - pointDelta.x,\n\t\t\ty: shape.y - pointDelta.y,\n\t\t\tprops: {\n\t\t\t\tcrop: {\n\t\t\t\t\ttopLeft: { x: 0, y: 0 },\n\t\t\t\t\tbottomRight: { x: 1, y: 1 },\n\t\t\t\t},\n\t\t\t\tw,\n\t\t\t\th,\n\t\t\t},\n\t\t}\n\n\t\tthis.editor.updateShapes([partial])\n\t}\n}\n\n/**\n * When an image is cropped we need to translate the image to show the portion withing the cropped\n * area. We do this by translating the image by the negative of the top left corner of the crop\n * area.\n *\n * @param shape - Shape The image shape for which to get the container style\n * @returns - Styles to apply to the image container\n */\nfunction getContainerStyle(shape: TLImageShape) {\n\tconst crop = shape.props.crop\n\tconst topLeft = crop?.topLeft\n\tif (!topLeft) return\n\n\tconst w = (1 / (crop.bottomRight.x - crop.topLeft.x)) * shape.props.w\n\tconst h = (1 / (crop.bottomRight.y - crop.topLeft.y)) * shape.props.h\n\n\tconst offsetX = -topLeft.x * w\n\tconst offsetY = -topLeft.y * h\n\treturn {\n\t\ttransform: `translate(${offsetX}px, ${offsetY}px)`,\n\t\twidth: w,\n\t\theight: h,\n\t}\n}\n"],"mappings":";;;;;;;;;AAmHG,SAAAA,QAAA,EAGGC,GAAA,EAaDC,IAAA,QAhBF;AAlHH,SAASC,KAAA,EAAOC,cAAA,QAAsB;AAEtC,SAASC,QAAA,QAAgB;AACzB,SAASC,SAAA,EAAWC,QAAA,QAAgB;AACpC,SAASC,QAAA,QAAgB;AACzB,SAASC,cAAA,QAAsB;AAC/B,SAASC,aAAA,QAAqB;AAC9B,SAASC,aAAA,QAAqB;AAC9B,SAASC,uBAAA,QAA+B;AACxC,SAASC,gBAAA,QAAwB;AAEjC,SAASC,eAAA,QAAuB;AAEhC,IAAMC,SAAA;EAAA,IAAAC,IAAA,GAAAC,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,CAAY,SAAAC,QAAOC,GAAA;IAAA,OAAAH,mBAAA,GAAAI,IAAA,UAAAC,SAAAC,QAAA;MAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;QAAA;UAAA,OAAAF,QAAA,CAAAG,MAAA,WACjB,IAAIC,OAAA,CAAQ,UAACC,OAAA,EAASC,MAAA,EAAW;YACvC,IAAMC,KAAA,GAAQ,IAAIC,KAAA,CAAM;YACxBD,KAAA,CAAME,MAAA,GAAS;cAAA,OAAMJ,OAAA,CAAQE,KAAK;YAAA;YAClCA,KAAA,CAAMG,OAAA,GAAU;cAAA,OAAMJ,MAAA,CAAO,IAAIK,KAAA,CAAM,sBAAsB,CAAC;YAAA;YAC9DJ,KAAA,CAAMK,WAAA,GAAc;YACpBL,KAAA,CAAMM,GAAA,GAAMhB,GAAA;UACb,CAAC;QAAA;QAAA;UAAA,OAAAG,QAAA,CAAAc,IAAA;MAAA;IAAA,GAAAlB,OAAA;EAAA,CACF;EAAA,gBARML,UAAAwB,EAAA;IAAA,OAAAvB,IAAA,CAAAwB,KAAA,OAAAC,SAAA;EAAA;AAAA,GAQN;AAEA,IAAMC,aAAA;EAAA,IAAAC,KAAA,GAAA1B,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,CAAgB,SAAAyB,SAAOvB,GAAA;IAAA,IAAAU,KAAA,EAAAc,MAAA,EAAAC,GAAA;IAAA,OAAA5B,mBAAA,GAAAI,IAAA,UAAAyB,UAAAC,SAAA;MAAA,kBAAAA,SAAA,CAAAvB,IAAA,GAAAuB,SAAA,CAAAtB,IAAA;QAAA;UAAAsB,SAAA,CAAAtB,IAAA;UAAA,OACRX,SAAA,CAAUM,GAAG;QAAA;UAA3BU,KAAA,GAAAiB,SAAA,CAAAC,IAAA;UAEAJ,MAAA,GAASK,QAAA,CAASC,aAAA,CAAc,QAAQ;UAC9CN,MAAA,CAAOO,KAAA,GAAQrB,KAAA,CAAMqB,KAAA;UACrBP,MAAA,CAAOQ,MAAA,GAAStB,KAAA,CAAMsB,MAAA;UAEhBP,GAAA,GAAMD,MAAA,CAAOS,UAAA,CAAW,IAAI;UAAA,IAC7BR,GAAA;YAAAE,SAAA,CAAAtB,IAAA;YAAA;UAAA;UAAA,OAAAsB,SAAA,CAAArB,MAAA;QAAA;UAELmB,GAAA,CAAIS,SAAA,CAAUxB,KAAA,EAAO,GAAG,CAAC;UAAA,OAAAiB,SAAA,CAAArB,MAAA,WAClBkB,MAAA,CAAOW,SAAA,CAAU;QAAA;QAAA;UAAA,OAAAR,SAAA,CAAAV,IAAA;MAAA;IAAA,GAAAM,QAAA;EAAA,CACzB;EAAA,gBAZMF,cAAAe,GAAA;IAAA,OAAAd,KAAA,CAAAH,KAAA,OAAAC,SAAA;EAAA;AAAA,GAYN;AAAA,SAEeiB,kBAAAC,GAAA;EAAA,OAAAC,kBAAA,CAAApB,KAAA,OAAAC,SAAA;AAAA;AAAA,SAAAmB,mBAAA;EAAAA,kBAAA,GAAA3C,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,CAAf,SAAA0C,SAAiCxC,GAAA;IAAA,IAAAyC,QAAA,EAAAC,IAAA;IAAA,OAAA7C,mBAAA,GAAAI,IAAA,UAAA0C,UAAAC,SAAA;MAAA,kBAAAA,SAAA,CAAAxC,IAAA,GAAAwC,SAAA,CAAAvC,IAAA;QAAA;UAAAuC,SAAA,CAAAvC,IAAA;UAAA,OACTwC,KAAA,CAAM7C,GAAG;QAAA;UAA1ByC,QAAA,GAAAG,SAAA,CAAAhB,IAAA;UAAAgB,SAAA,CAAAvC,IAAA;UAAA,OACaoC,QAAA,CAASC,IAAA,CAAK;QAAA;UAA3BA,IAAA,GAAAE,SAAA,CAAAhB,IAAA;UAAA,OAAAgB,SAAA,CAAAtC,MAAA,WACC,IAAIC,OAAA,CAAQ,UAACC,OAAA,EAASC,MAAA,EAAW;YACvC,IAAMqC,MAAA,GAAS,IAAIC,UAAA,CAAW;YAC9BD,MAAA,CAAOE,SAAA,GAAY;cAAA,OAAMxC,OAAA,CAAQsC,MAAA,CAAOG,MAAgB;YAAA;YACxDH,MAAA,CAAOjC,OAAA,GAAUJ,MAAA;YACjBqC,MAAA,CAAOI,aAAA,CAAcR,IAAI;UAC1B,CAAC;QAAA;QAAA;UAAA,OAAAE,SAAA,CAAA3B,IAAA;MAAA;IAAA,GAAAuB,QAAA;EAAA,CACF;EAAA,OAAAD,kBAAA,CAAApB,KAAA,OAAAC,SAAA;AAAA;AAAA,IAGa+B,cAAA,0BAAAC,iBAAA;EAAAC,SAAA,CAAAF,cAAA,EAAAC,iBAAA;EAAA,IAAAE,MAAA,GAAAC,YAAA,CAAAJ,cAAA;EAAA,SAAAA,eAAA;IAAA,IAAAK,KAAA;IAAAC,eAAA,OAAAN,cAAA;IAAA,SAAAO,IAAA,GAAAtC,SAAA,CAAAuC,MAAA,EAAAC,IAAA,OAAAC,KAAA,CAAAH,IAAA,GAAAI,IAAA,MAAAA,IAAA,GAAAJ,IAAA,EAAAI,IAAA;MAAAF,IAAA,CAAAE,IAAA,IAAA1C,SAAA,CAAA0C,IAAA;IAAA;IAAAN,KAAA,GAAAF,MAAA,CAAAS,IAAA,CAAA5C,KAAA,CAAAmC,MAAA,SAAAU,MAAA,CAAAJ,IAAA;IAAAK,eAAA,CAAAC,sBAAA,CAAAV,KAAA,0BAGmB;MAAA,OAAM;IAAA;IAAAS,eAAA,CAAAC,sBAAA,CAAAV,KAAA,cAClB;MAAA,OAAM;IAAA;IAAAS,eAAA,CAAAC,sBAAA,CAAAV,KAAA,oBAuJT,UAACW,KAAA,EAAwB;MACxC,IAAMC,KAAA,GAAQD,KAAA,CAAME,KAAA,CAAMC,OAAA,GAAUd,KAAA,CAAKe,MAAA,CAAOC,YAAA,CAAaL,KAAA,CAAME,KAAA,CAAMC,OAAO,IAAI;MAEpF,IAAI,CAACF,KAAA,EAAO;MAEZ,IAAMK,OAAA,GACLL,KAAA,CAAMC,KAAA,CAAMrD,GAAA,IAAO,cAAcoD,KAAA,CAAMC,KAAA,IAASD,KAAA,CAAMC,KAAA,CAAMK,QAAA,KAAa;MAE1E,IAAI,CAACD,OAAA,EAAS;MAEdjB,KAAA,CAAKe,MAAA,CAAOI,YAAA,CAAa,CACxB;QACCC,IAAA,EAAM;QACNC,EAAA,EAAIV,KAAA,CAAMU,EAAA;QACVR,KAAA,EAAO;UACNS,OAAA,EAAS,CAACX,KAAA,CAAME,KAAA,CAAMS;QACvB;MACD,EACA;IACF;IAAAb,eAAA,CAAAC,sBAAA,CAAAV,KAAA,wBAE0D,UAACW,KAAA,EAAU;MACpE,IAAME,KAAA,GAAQF,KAAA,CAAME,KAAA;MACpB,IAAI,CAACA,KAAA,EAAO;MAEZ,IAAIb,KAAA,CAAKe,MAAA,CAAOQ,UAAA,KAAeZ,KAAA,CAAMU,EAAA,EAAI;QACxC;MACD;MAEA,IAAMG,IAAA,GAAOhG,QAAA,CAASqF,KAAA,CAAMW,IAAI,KAAK;QACpCC,OAAA,EAAS;UAAEC,CAAA,EAAG;UAAGC,CAAA,EAAG;QAAE;QACtBC,WAAA,EAAa;UAAEF,CAAA,EAAG;UAAGC,CAAA,EAAG;QAAE;MAC3B;MAGA,IAAME,CAAA,GAAK,KAAKL,IAAA,CAAKI,WAAA,CAAYF,CAAA,GAAIF,IAAA,CAAKC,OAAA,CAAQC,CAAA,IAAMf,KAAA,CAAME,KAAA,CAAMgB,CAAA;MACpE,IAAMC,CAAA,GAAK,KAAKN,IAAA,CAAKI,WAAA,CAAYD,CAAA,GAAIH,IAAA,CAAKC,OAAA,CAAQE,CAAA,IAAMhB,KAAA,CAAME,KAAA,CAAMiB,CAAA;MAEpE,IAAMC,UAAA,GAAa,IAAIzG,KAAA,CAAMkG,IAAA,CAAKC,OAAA,CAAQC,CAAA,GAAIG,CAAA,EAAGL,IAAA,CAAKC,OAAA,CAAQE,CAAA,GAAIG,CAAC,EAAEE,GAAA,CAAIrB,KAAA,CAAMsB,QAAQ;MAEvF,IAAMC,OAAA,GAAwC;QAC7Cb,EAAA,EAAIV,KAAA,CAAMU,EAAA;QACVD,IAAA,EAAMT,KAAA,CAAMS,IAAA;QACZM,CAAA,EAAGf,KAAA,CAAMe,CAAA,GAAIK,UAAA,CAAWL,CAAA;QACxBC,CAAA,EAAGhB,KAAA,CAAMgB,CAAA,GAAII,UAAA,CAAWJ,CAAA;QACxBd,KAAA,EAAO;UACNW,IAAA,EAAM;YACLC,OAAA,EAAS;cAAEC,CAAA,EAAG;cAAGC,CAAA,EAAG;YAAE;YACtBC,WAAA,EAAa;cAAEF,CAAA,EAAG;cAAGC,CAAA,EAAG;YAAE;UAC3B;UACAE,CAAA,EAAAA,CAAA;UACAC,CAAA,EAAAA;QACD;MACD;MAEA9B,KAAA,CAAKe,MAAA,CAAOI,YAAA,CAAa,CAACe,OAAO,CAAC;IACnC;IAAA,OAAAlC,KAAA;EAAA;EAAAmC,YAAA,CAAAxC,cAAA;IAAAyC,GAAA;IAAAC,KAAA,EA7MS,SAAAC,aAAA,EAAsC;MAC9C,OAAO;QACNT,CAAA,EAAG;QACHC,CAAA,EAAG;QACHhB,OAAA,EAAS;QACTQ,OAAA,EAAS;QACT9E,GAAA,EAAK;QACLgF,IAAA,EAAM;MACP;IACD;EAAA;IAAAY,GAAA;IAAAC,KAAA,EAEA,SAAAE,UAAU5B,KAAA,EAAqB;MAAA,IAAA6B,MAAA;QAAAC,qBAAA;QAAAC,sBAAA;MAC9B,IAAMC,cAAA,GAAiBC,iBAAA,CAAkBjC,KAAK;MAC9C,IAAMkC,UAAA,GAAa/G,aAAA,CAAc6E,KAAA,CAAMU,EAAE;MACzC,IAAMyB,oBAAA,GAAuB/G,uBAAA,CAAwB;MACrD,IAAAgH,SAAA,GAA4CrH,QAAA,CAAS,EAAE;QAAAsH,UAAA,GAAAC,cAAA,CAAAF,SAAA;QAAhDG,cAAA,GAAAF,UAAA;QAAgBG,iBAAiB,GAAAH,UAAA;MAExC,IAAAI,YAAA,GAAiBzC,KAAA,CAAME,KAAA;QAAfgB,CAAA,GAAAuB,YAAA,CAAAvB,CAAA;QAAGC,CAAA,GAAAsB,YAAA,CAAAtB,CAAA;MACX,IAAMlB,KAAA,GAAQD,KAAA,CAAME,KAAA,CAAMC,OAAA,GAAU,KAAKC,MAAA,CAAOC,YAAA,CAAaL,KAAA,CAAME,KAAA,CAAMC,OAAO,IAAI;MAEpF,IAAI,CAAAF,KAAA,aAAAA,KAAA,uBAAAA,KAAA,CAAOQ,IAAA,MAAS,YAAY;QAC/B,MAAM9D,KAAA,CAAM,6CAA6C;MAC1D;MAEA,IAAM+F,UAAA,GAAa1H,QAAA,CAClB,qBACA;QAAA,IAAA2H,qBAAA;QAAA,OAAM3C,KAAA,CAAMU,EAAA,OAAAiC,qBAAA,GAAOd,MAAA,CAAKzB,MAAA,CAAOwC,iBAAA,cAAAD,qBAAA,uBAAZA,qBAAA,CAA+BjC,EAAA;MAAA,GAClD,CAAC,KAAKN,MAAM,CACb;MAEA,IAAMyC,eAAA,GACLH,UAAA,IACAR,UAAA,IACA,KAAK9B,MAAA,CAAO0C,OAAA,CAAQ,eAAe,mBAAmB,6BAA6B;MAGpF,IAAMC,YAAA,GACLZ,oBAAA,KACC,CAAAlC,KAAA,aAAAA,KAAA,gBAAA6B,qBAAA,GAAA7B,KAAA,CAAOC,KAAA,CAAMK,QAAA,cAAAuB,qBAAA,uBAAbA,qBAAA,CAAuBkB,QAAA,CAAS,OAAO,OAAK/C,KAAA,aAAAA,KAAA,gBAAA8B,sBAAA,GAAA9B,KAAA,CAAOC,KAAA,CAAMK,QAAA,cAAAwB,sBAAA,uBAAbA,sBAAA,CAAuBiB,QAAA,CAAS,KAAK;MAEnFlI,SAAA,CAAU,YAAM;QACf,IAAImF,KAAA,aAAAA,KAAA,eAAAA,KAAA,CAAOC,KAAA,CAAMrD,GAAA,IAAO,cAAcoD,KAAA,CAAMC,KAAA,IAAS,CAAAD,KAAA,aAAAA,KAAA,uBAAAA,KAAA,CAAOC,KAAA,CAAMK,QAAA,MAAa,aAAa;UAC3F,IAAI0C,SAAA,GAAY;UAChB,IAAMC,GAAA;YAAA,IAAAC,KAAA,GAAA1H,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,CAAM,SAAAyH,SAAA;cAAA,IAAAC,cAAA;cAAA,OAAA3H,mBAAA,GAAAI,IAAA,UAAAwH,UAAAC,SAAA;gBAAA,kBAAAA,SAAA,CAAAtH,IAAA,GAAAsH,SAAA,CAAArH,IAAA;kBAAA;oBAAAqH,SAAA,CAAArH,IAAA;oBAAA,OACkBgB,aAAA,CAAc+C,KAAA,CAAMC,KAAA,CAAMrD,GAAI;kBAAA;oBAArDwG,cAAA,GAAAE,SAAA,CAAA9F,IAAA;oBAAA,KACFwF,SAAA;sBAAAM,SAAA,CAAArH,IAAA;sBAAA;oBAAA;oBAAA,OAAAqH,SAAA,CAAApH,MAAA;kBAAA;oBACJ,IAAIkH,cAAA,EAAgB;sBACnBb,iBAAA,CAAkBa,cAAc;oBACjC;kBAAA;kBAAA;oBAAA,OAAAE,SAAA,CAAAzG,IAAA;gBAAA;cAAA,GAAAsG,QAAA;YAAA,CACD;YAAA,gBANMF,IAAA;cAAA,OAAAC,KAAA,CAAAnG,KAAA,OAAAC,SAAA;YAAA;UAAA,GAMN;UACAiG,GAAA,CAAI;UAEJ,OAAO,YAAM;YACZD,SAAA,GAAY;UACb;QACD;MACD,GAAG,CAACd,oBAAA,EAAsBlC,KAAA,aAAAA,KAAA,uBAAAA,KAAA,CAAOC,KAAK,CAAC;MAEvC,OACC,eAAAxF,IAAA,CAAAF,QAAA;QACEgJ,QAAA,IAAAvD,KAAA,aAAAA,KAAA,uBAAAA,KAAA,CAAOC,KAAA,CAAMrD,GAAA,KAAOgG,eAAA,IACpB,eAAApI,GAAA,CAAC;UAAIgJ,KAAA,EAAOzB,cAAA;UACXwB,QAAA,iBAAA/I,GAAA,CAAC;YACAiJ,SAAA,uBAAA7D,MAAA,CAAgCG,KAAA,CAAMU,EAAA;YACtC+C,KAAA,EAAO;cACNE,OAAA,EAAS;cACTC,eAAA,SAAA/D,MAAA,CACC,CAACG,KAAA,CAAME,KAAA,CAAMS,OAAA,IAAWoC,YAAA,GAAeR,cAAA,GAAiBtC,KAAA,CAAMC,KAAA,CAAMrD,GAAA;YAEtE;YACAgH,SAAA,EAAW;UAAA,CACZ;QAAA,CACD,GAED,eAAApJ,GAAA,CAACS,aAAA;UAAcwF,EAAA,EAAIV,KAAA,CAAMU,EAAA;UAAI+C,KAAA,EAAO;YAAEK,QAAA,EAAU;UAAS;UACxDN,QAAA,iBAAA9I,IAAA,CAAC;YAAIgJ,SAAA,EAAU;YAAqBD,KAAA,EAAOzB,cAAA;YACzCwB,QAAA,GAAAvD,KAAA,aAAAA,KAAA,eAAAA,KAAA,CAAOC,KAAA,CAAMrD,GAAA,GACb,eAAApC,GAAA,CAAC;cACAiJ,SAAA,uBAAA7D,MAAA,CAAgCG,KAAA,CAAMU,EAAA;cACtC+C,KAAA,EAAO;gBACNG,eAAA,SAAA/D,MAAA,CACC,CAACG,KAAA,CAAME,KAAA,CAAMS,OAAA,IAAWoC,YAAA,GAAeR,cAAA,GAAiBtC,KAAA,CAAMC,KAAA,CAAMrD,GAAA;cAEtE;cACAgH,SAAA,EAAW;YAAA,CACZ,IAEA,eAAApJ,GAAA,CAAC;cAAEsJ,SAAA,eAAAlE,MAAA,CAAW,CAAcqB,CAAA,GAAI,MAAM,SAAArB,MAAA,EAAOsB,CAAA,GAAI,MAAM;cACtDqC,QAAA,iBAAA/I,GAAA,CAACQ,cAAA,IAAe;YAAA,CACjB,GAEA,CAAAgF,KAAA,aAAAA,KAAA,uBAAAA,KAAA,CAAOC,KAAA,CAAM8D,UAAA,KAAc,CAAChE,KAAA,CAAME,KAAA,CAAMS,OAAA,IACxC,eAAAlG,GAAA,CAAC;cAAIiJ,SAAA,EAAU;cAAeF,QAAA;YAAA,CAAG;UAAA,CAEnC;QAAA,CACD,GACC,SAASxD,KAAA,CAAME,KAAA,IAASF,KAAA,CAAME,KAAA,CAAMrE,GAAA,IACpC,eAAApB,GAAA,CAACa,eAAA;UAAgBO,GAAA,EAAKmE,KAAA,CAAME,KAAA,CAAMrE,GAAA;UAAKoI,SAAA,EAAW,KAAK7D,MAAA,CAAO6D;QAAA,CAAW;MAAA,CAE3E;IAEF;EAAA;IAAAxC,GAAA;IAAAC,KAAA,EAEA,SAAAwC,UAAUlE,KAAA,EAAqB;MAC9B,IAAMkC,UAAA,GAAa/G,aAAA,CAAc6E,KAAA,CAAMU,EAAE;MACzC,IAAIwB,UAAA,EAAY;QACf,OAAO;MACR;MACA,OAAO,eAAAzH,GAAA,CAAC;QAAKmD,KAAA,EAAOhD,cAAA,CAAeoF,KAAA,CAAME,KAAA,CAAMgB,CAAC;QAAGrD,MAAA,EAAQjD,cAAA,CAAeoF,KAAA,CAAME,KAAA,CAAMiB,CAAC;MAAA,CAAG;IAC3F;EAAA;IAAAM,GAAA;IAAAC,KAAA;MAAA,IAAAyC,MAAA,GAAA1I,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,CAEA,SAAAyI,SAAYpE,KAAA;QAAA,IAAAqE,CAAA,EAAApE,KAAA,EAAApD,GAAA,EAAAN,KAAA,EAAAyF,cAAA,EAAAnB,IAAA,EAAAkD,SAAA,EAAAnG,KAAA,EAAAC,MAAA,EAAAyG,MAAA,EAAAC,YAAA;QAAA,OAAA7I,mBAAA,GAAAI,IAAA,UAAA0I,UAAAC,SAAA;UAAA,kBAAAA,SAAA,CAAAxI,IAAA,GAAAwI,SAAA,CAAAvI,IAAA;YAAA;cACLmI,CAAA,GAAI3G,QAAA,CAASgH,eAAA,CAAgB,8BAA8B,GAAG;cAC9DzE,KAAA,GAAQD,KAAA,CAAME,KAAA,CAAMC,OAAA,GAAU,KAAKC,MAAA,CAAOC,YAAA,CAAaL,KAAA,CAAME,KAAA,CAAMC,OAAO,IAAI;cAEhFtD,GAAA,GAAM,CAAAoD,KAAA,aAAAA,KAAA,uBAAAA,KAAA,CAAOC,KAAA,CAAMrD,GAAA,KAAO;cAAA,MAC1BA,GAAA,IAAOA,GAAA,CAAI8H,UAAA,CAAW,MAAM;gBAAAF,SAAA,CAAAvI,IAAA;gBAAA;cAAA;cAAAuI,SAAA,CAAAvI,IAAA;cAAA,OAElBgC,iBAAkB,CAAArB,GAAG;YAAA;cAAA4H,SAAA,CAAAG,EAAA,GAAAH,SAAA,CAAAhH,IAAA;cAAA,IAAAgH,SAAA,CAAAG,EAAA;gBAAAH,SAAA,CAAAvI,IAAA;gBAAA;cAAA;cAAAuI,SAAA,CAAAG,EAAA,GAAM;YAAA;cAAxC/H,GAAA,GAAA4H,SAAA,CAAAG,EAAA;YAAA;cAGKrI,KAAA,GAAQmB,QAAA,CAASgH,eAAA,CAAgB,8BAA8B,OAAO;cAC5EnI,KAAA,CAAMsI,cAAA,CAAe,gCAAgC,QAAQhI,GAAG;cAC1DmF,cAAA,GAAiBC,iBAAA,CAAkBjC,KAAK;cACxCa,IAAA,GAAOb,KAAA,CAAME,KAAA,CAAMW,IAAA;cACzB,IAAImB,cAAA,IAAkBnB,IAAA,EAAM;gBACnBkD,SAAA,GAA6B/B,cAAA,CAA7B+B,SAAA,EAAWnG,KAAA,GAAkBoE,cAAA,CAAlBpE,KAAA,EAAOC,MAAA,GAAWmE,cAAA,CAAXnE,MAAA;gBACpByG,MAAA,GAAS,CACd,IAAI3J,KAAA,CAAMkG,IAAA,CAAKC,OAAA,CAAQC,CAAA,GAAInD,KAAA,EAAOiD,IAAA,CAAKC,OAAA,CAAQE,CAAA,GAAInD,MAAM,GACzD,IAAIlD,KAAA,CAAMkG,IAAA,CAAKI,WAAA,CAAYF,CAAA,GAAInD,KAAA,EAAOiD,IAAA,CAAKC,OAAA,CAAQE,CAAA,GAAInD,MAAM,GAC7D,IAAIlD,KAAA,CAAMkG,IAAA,CAAKI,WAAA,CAAYF,CAAA,GAAInD,KAAA,EAAOiD,IAAA,CAAKI,WAAA,CAAYD,CAAA,GAAInD,MAAM,GACjE,IAAIlD,KAAA,CAAMkG,IAAA,CAAKC,OAAA,CAAQC,CAAA,GAAInD,KAAA,EAAOiD,IAAA,CAAKI,WAAA,CAAYD,CAAA,GAAInD,MAAM,EAC9D;gBACM0G,YAAA,GAAe7G,QAAA,CAASgH,eAAA,CAAgB,8BAA8B,GAAG;gBAC/EH,YAAA,CAAad,KAAA,CAAMqB,QAAA,cAAAjF,MAAA,CAAsByE,MAAA,CAAOS,GAAA,CAAI,UAACC,CAAA;kBAAA,UAAAnF,MAAA,CAASmF,CAAA,CAAEjE,CAAA,SAAAlB,MAAA,CAAOmF,CAAA,CAAEhE,CAAA;gBAAA,CAAK,EAAEiE,IAAA,CAAK,GAAG;gBACxF1I,KAAA,CAAM2I,YAAA,CAAa,SAAStH,KAAA,CAAMuH,QAAA,CAAS,CAAC;gBAC5C5I,KAAA,CAAM2I,YAAA,CAAa,UAAUrH,MAAA,CAAOsH,QAAA,CAAS,CAAC;gBAC9C5I,KAAA,CAAMkH,KAAA,CAAMM,SAAA,GAAYA,SAAA;gBACxBQ,YAAA,CAAaa,WAAA,CAAY7I,KAAK;gBAC9B8H,CAAA,CAAEe,WAAA,CAAYb,YAAY;cAC3B,OAAO;gBACNhI,KAAA,CAAM2I,YAAA,CAAa,SAASlF,KAAA,CAAME,KAAA,CAAMgB,CAAA,CAAEiE,QAAA,CAAS,CAAC;gBACpD5I,KAAA,CAAM2I,YAAA,CAAa,UAAUlF,KAAA,CAAME,KAAA,CAAMiB,CAAA,CAAEgE,QAAA,CAAS,CAAC;gBACrDd,CAAA,CAAEe,WAAA,CAAY7I,KAAK;cACpB;cAAA,OAAAkI,SAAA,CAAAtI,MAAA,WAEOkI,CAAA;YAAA;YAAA;cAAA,OAAAI,SAAA,CAAA3H,IAAA;UAAA;QAAA,GAAAsH,QAAA;MAAA,CACR;MAAA,SAAAiB,MAAAC,GAAA;QAAA,OAAAnB,MAAA,CAAAnH,KAAA,OAAAC,SAAA;MAAA;MAAA,OAAAoI,KAAA;IAAA;EAAA;EAAA,OAAArG,cAAA;AAAA,EAzJmC3D,gBAAA;AAAAyE,eAAA,CAAvBd,cAAA,UACW;AA6NxB,SAASiD,kBAAkBjC,KAAA,EAAqB;EAC/C,IAAMa,IAAA,GAAOb,KAAA,CAAME,KAAA,CAAMW,IAAA;EACzB,IAAMC,OAAA,GAAUD,IAAA,aAAAA,IAAA,uBAAAA,IAAA,CAAMC,OAAA;EACtB,IAAI,CAACA,OAAA,EAAS;EAEd,IAAMI,CAAA,GAAK,KAAKL,IAAA,CAAKI,WAAA,CAAYF,CAAA,GAAIF,IAAA,CAAKC,OAAA,CAAQC,CAAA,IAAMf,KAAA,CAAME,KAAA,CAAMgB,CAAA;EACpE,IAAMC,CAAA,GAAK,KAAKN,IAAA,CAAKI,WAAA,CAAYD,CAAA,GAAIH,IAAA,CAAKC,OAAA,CAAQE,CAAA,IAAMhB,KAAA,CAAME,KAAA,CAAMiB,CAAA;EAEpE,IAAMoE,OAAA,GAAU,CAACzE,OAAA,CAAQC,CAAA,GAAIG,CAAA;EAC7B,IAAMsE,OAAA,GAAU,CAAC1E,OAAA,CAAQE,CAAA,GAAIG,CAAA;EAC7B,OAAO;IACN4C,SAAA,eAAAlE,MAAA,CAAwB0F,OAAA,UAAA1F,MAAA,CAAc2F,OAAA;IACtC5H,KAAA,EAAOsD,CAAA;IACPrD,MAAA,EAAQsD;EACT;AACD"},"metadata":{},"sourceType":"module","externalDependencies":[]}