{
  "version": 3,
  "sources": ["../../../../../src/lib/editor/shapes/frame/FrameShapeUtil.tsx"],
  "sourcesContent": ["import { canolicalizeRotation, SelectionEdge, toDomPrecision } from '@tldraw/primitives'\nimport { TLFrameShape, TLShape, TLShapeId } from '@tldraw/tlschema'\nimport { last } from '@tldraw/utils'\nimport { SVGContainer } from '../../../components/SVGContainer'\nimport { defaultEmptyAs } from '../../../utils/string'\nimport { BaseBoxShapeUtil } from '../BaseBoxShapeUtil'\nimport { GroupShapeUtil } from '../group/GroupShapeUtil'\nimport { TLOnResizeEndHandler } from '../ShapeUtil'\nimport { createTextSvgElementFromSpans } from '../shared/createTextSvgElementFromSpans'\nimport { TLExportColors } from '../shared/TLExportColors'\nimport { FrameHeading } from './components/FrameHeading'\n\n/** @public */\nexport class FrameShapeUtil extends BaseBoxShapeUtil<TLFrameShape> {\n\tstatic override type = 'frame' as const\n\n\toverride canBind = () => true\n\n\toverride canEdit = () => true\n\n\toverride defaultProps(): TLFrameShape['props'] {\n\t\treturn { w: 160 * 2, h: 90 * 2, name: '' }\n\t}\n\n\toverride component(shape: TLFrameShape) {\n\t\tconst bounds = this.bounds(shape)\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<SVGContainer>\n\t\t\t\t\t<rect className=\"tl-hitarea-stroke\" width={bounds.width} height={bounds.height} />\n\t\t\t\t\t<rect\n\t\t\t\t\t\tclassName=\"tl-frame__body\"\n\t\t\t\t\t\twidth={bounds.width}\n\t\t\t\t\t\theight={bounds.height}\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t/>\n\t\t\t\t</SVGContainer>\n\t\t\t\t<FrameHeading\n\t\t\t\t\tid={shape.id}\n\t\t\t\t\tname={shape.props.name}\n\t\t\t\t\twidth={bounds.width}\n\t\t\t\t\theight={bounds.height}\n\t\t\t\t/>\n\t\t\t</>\n\t\t)\n\t}\n\n\toverride toSvg(\n\t\tshape: TLFrameShape,\n\t\tfont: string,\n\t\tcolors: TLExportColors\n\t): SVGElement | Promise<SVGElement> {\n\t\tconst g = document.createElementNS('http://www.w3.org/2000/svg', 'g')\n\n\t\tconst rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect')\n\t\trect.setAttribute('width', shape.props.w.toString())\n\t\trect.setAttribute('height', shape.props.h.toString())\n\t\trect.setAttribute('fill', colors.solid)\n\t\trect.setAttribute('stroke', colors.fill.black)\n\t\trect.setAttribute('stroke-width', '1')\n\t\trect.setAttribute('rx', '1')\n\t\trect.setAttribute('ry', '1')\n\t\tg.appendChild(rect)\n\n\t\t// Text label\n\t\tconst pageRotation = canolicalizeRotation(this.editor.getPageRotationById(shape.id))\n\t\t// rotate right 45 deg\n\t\tconst offsetRotation = pageRotation + Math.PI / 4\n\t\tconst scaledRotation = (offsetRotation * (2 / Math.PI) + 4) % 4\n\t\tconst labelSide: SelectionEdge = (['top', 'left', 'bottom', 'right'] as const)[\n\t\t\tMath.floor(scaledRotation)\n\t\t]\n\n\t\tlet labelTranslate: string\n\t\tswitch (labelSide) {\n\t\t\tcase 'top':\n\t\t\t\tlabelTranslate = ``\n\t\t\t\tbreak\n\t\t\tcase 'right':\n\t\t\t\tlabelTranslate = `translate(${toDomPrecision(shape.props.w)}px, 0px) rotate(90deg)`\n\t\t\t\tbreak\n\t\t\tcase 'bottom':\n\t\t\t\tlabelTranslate = `translate(${toDomPrecision(shape.props.w)}px, ${toDomPrecision(\n\t\t\t\t\tshape.props.h\n\t\t\t\t)}px) rotate(180deg)`\n\t\t\t\tbreak\n\t\t\tcase 'left':\n\t\t\t\tlabelTranslate = `translate(0px, ${toDomPrecision(shape.props.h)}px) rotate(270deg)`\n\t\t\t\tbreak\n\t\t\tdefault:\n\t\t\t\tlabelTranslate = ``\n\t\t}\n\n\t\t// Truncate with ellipsis\n\t\tconst opts = {\n\t\t\tfontSize: 12,\n\t\t\tfontFamily: 'Inter, sans-serif',\n\t\t\ttextAlign: 'start' as const,\n\t\t\twidth: shape.props.w,\n\t\t\theight: 32,\n\t\t\tpadding: 0,\n\t\t\tlineHeight: 1,\n\t\t\tfontStyle: 'normal',\n\t\t\tfontWeight: 'normal',\n\t\t\toverflow: 'truncate-ellipsis' as const,\n\t\t\tverticalTextAlign: 'middle' as const,\n\t\t}\n\n\t\tconst spans = this.editor.textMeasure.measureTextSpans(\n\t\t\tdefaultEmptyAs(shape.props.name, 'Frame') + String.fromCharCode(8203),\n\t\t\topts\n\t\t)\n\n\t\tconst firstSpan = spans[0]\n\t\tconst lastSpan = last(spans)!\n\t\tconst labelTextWidth = lastSpan.box.w + lastSpan.box.x - firstSpan.box.x\n\t\tconst text = createTextSvgElementFromSpans(this.editor, spans, {\n\t\t\toffsetY: -opts.height - 2,\n\t\t\t...opts,\n\t\t})\n\t\ttext.style.setProperty('transform', labelTranslate)\n\n\t\tconst textBg = document.createElementNS('http://www.w3.org/2000/svg', 'rect')\n\t\ttextBg.setAttribute('x', '-8px')\n\t\ttextBg.setAttribute('y', -opts.height - 4 + 'px')\n\t\ttextBg.setAttribute('width', labelTextWidth + 16 + 'px')\n\t\ttextBg.setAttribute('height', `${opts.height}px`)\n\t\ttextBg.setAttribute('rx', 4 + 'px')\n\t\ttextBg.setAttribute('ry', 4 + 'px')\n\t\ttextBg.setAttribute('fill', colors.background)\n\n\t\tg.appendChild(textBg)\n\t\tg.appendChild(text)\n\n\t\treturn g\n\t}\n\n\tindicator(shape: TLFrameShape) {\n\t\tconst bounds = this.bounds(shape)\n\n\t\treturn (\n\t\t\t<rect\n\t\t\t\twidth={toDomPrecision(bounds.width)}\n\t\t\t\theight={toDomPrecision(bounds.height)}\n\t\t\t\tclassName={`tl-frame-indicator`}\n\t\t\t/>\n\t\t)\n\t}\n\n\toverride canReceiveNewChildrenOfType = (shape: TLShape, _type: TLShape['type']) => {\n\t\treturn !shape.isLocked\n\t}\n\n\toverride providesBackgroundForChildren(): boolean {\n\t\treturn true\n\t}\n\n\toverride canDropShapes = (shape: TLFrameShape, _shapes: TLShape[]): boolean => {\n\t\treturn !shape.isLocked\n\t}\n\n\toverride onDragShapesOver = (frame: TLFrameShape, shapes: TLShape[]): { shouldHint: boolean } => {\n\t\tif (!shapes.every((child) => child.parentId === frame.id)) {\n\t\t\tthis.editor.reparentShapesById(\n\t\t\t\tshapes.map((shape) => shape.id),\n\t\t\t\tframe.id\n\t\t\t)\n\t\t\treturn { shouldHint: true }\n\t\t}\n\t\treturn { shouldHint: false }\n\t}\n\n\tonDragShapesOut = (_shape: TLFrameShape, shapes: TLShape[]): void => {\n\t\tconst parent = this.editor.getShapeById(_shape.parentId)\n\t\tconst isInGroup = parent && this.editor.isShapeOfType(parent, GroupShapeUtil)\n\n\t\t// If frame is in a group, keep the shape\n\t\t// moved out in that group\n\t\tif (isInGroup) {\n\t\t\tthis.editor.reparentShapesById(\n\t\t\t\tshapes.map((shape) => shape.id),\n\t\t\t\tparent.id\n\t\t\t)\n\t\t} else {\n\t\t\tthis.editor.reparentShapesById(\n\t\t\t\tshapes.map((shape) => shape.id),\n\t\t\t\tthis.editor.currentPageId\n\t\t\t)\n\t\t}\n\t}\n\n\toverride onResizeEnd: TLOnResizeEndHandler<TLFrameShape> = (shape) => {\n\t\tconst bounds = this.editor.getPageBounds(shape)!\n\t\tconst children = this.editor.getSortedChildIds(shape.id)\n\n\t\tconst shapesToReparent: TLShapeId[] = []\n\n\t\tfor (const childId of children) {\n\t\t\tconst childBounds = this.editor.getPageBoundsById(childId)!\n\t\t\tif (!bounds.includes(childBounds)) {\n\t\t\t\tshapesToReparent.push(childId)\n\t\t\t}\n\t\t}\n\n\t\tif (shapesToReparent.length > 0) {\n\t\t\tthis.editor.reparentShapesById(shapesToReparent, this.editor.currentPageId)\n\t\t}\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
