{
  "version": 3,
  "sources": ["../../../../../src/lib/editor/shapes/group/GroupShapeUtil.tsx"],
  "sourcesContent": ["import { Box2d, Matrix2d, Vec2d } from '@tldraw/primitives'\nimport { TLGroupShape } from '@tldraw/tlschema'\nimport { SVGContainer } from '../../../components/SVGContainer'\nimport { ShapeUtil, TLOnChildrenChangeHandler } from '../ShapeUtil'\nimport { DashedOutlineBox } from '../shared/DashedOutlineBox'\n\n/** @public */\nexport class GroupShapeUtil extends ShapeUtil<TLGroupShape> {\n\tstatic override type = 'group' as const\n\n\ttype = 'group' as const\n\n\thideSelectionBoundsBg = () => false\n\thideSelectionBoundsFg = () => true\n\n\tcanBind = () => false\n\n\tdefaultProps(): TLGroupShape['props'] {\n\t\treturn {}\n\t}\n\n\tgetBounds(shape: TLGroupShape): Box2d {\n\t\tconst children = this.editor.getSortedChildIds(shape.id)\n\t\tif (children.length === 0) {\n\t\t\treturn new Box2d()\n\t\t}\n\n\t\tconst allChildPoints = children.flatMap((childId) => {\n\t\t\tconst shape = this.editor.getShapeById(childId)!\n\t\t\treturn this.editor\n\t\t\t\t.getOutlineById(childId)\n\t\t\t\t.map((point) => Matrix2d.applyToPoint(this.editor.getTransform(shape), point))\n\t\t})\n\n\t\treturn Box2d.FromPoints(allChildPoints)\n\t}\n\n\tgetCenter(shape: TLGroupShape): Vec2d {\n\t\treturn this.bounds(shape).center\n\t}\n\n\tgetOutline(shape: TLGroupShape): Vec2d[] {\n\t\treturn this.bounds(shape).corners\n\t}\n\n\tcomponent(shape: TLGroupShape) {\n\t\t// Not a class component, but eslint can't tell that :(\n\t\tconst {\n\t\t\terasingIdsSet,\n\t\t\tpageState: { hintingIds, focusLayerId },\n\t\t\tzoomLevel,\n\t\t} = this.editor\n\n\t\tconst isErasing = erasingIdsSet.has(shape.id)\n\n\t\tconst isHintingOtherGroup =\n\t\t\thintingIds.length > 0 &&\n\t\t\thintingIds.some(\n\t\t\t\t(id) =>\n\t\t\t\t\tid !== shape.id &&\n\t\t\t\t\tthis.editor.isShapeOfType(this.editor.getShapeById(id)!, GroupShapeUtil)\n\t\t\t)\n\n\t\tif (\n\t\t\t// always show the outline while we're erasing the group\n\t\t\t!isErasing &&\n\t\t\t// show the outline while the group is focused unless something outside of the group is being hinted\n\t\t\t// this happens dropping shapes from a group onto some outside group\n\t\t\t(shape.id !== focusLayerId || isHintingOtherGroup)\n\t\t) {\n\t\t\treturn null\n\t\t}\n\n\t\tconst bounds = this.bounds(shape)\n\n\t\treturn (\n\t\t\t<SVGContainer id={shape.id}>\n\t\t\t\t<DashedOutlineBox className=\"tl-group\" bounds={bounds} zoomLevel={zoomLevel} />\n\t\t\t</SVGContainer>\n\t\t)\n\t}\n\n\tindicator(shape: TLGroupShape) {\n\t\t// Not a class component, but eslint can't tell that :(\n\t\tconst {\n\t\t\tcamera: { z: zoomLevel },\n\t\t} = this.editor\n\n\t\tconst bounds = this.bounds(shape)\n\n\t\treturn <DashedOutlineBox className=\"\" bounds={bounds} zoomLevel={zoomLevel} />\n\t}\n\n\tonChildrenChange: TLOnChildrenChangeHandler<TLGroupShape> = (group) => {\n\t\tconst children = this.editor.getSortedChildIds(group.id)\n\t\tif (children.length === 0) {\n\t\t\tif (this.editor.pageState.focusLayerId === group.id) {\n\t\t\t\tthis.editor.popFocusLayer()\n\t\t\t}\n\t\t\tthis.editor.deleteShapes([group.id])\n\t\t\treturn\n\t\t} else if (children.length === 1) {\n\t\t\tif (this.editor.pageState.focusLayerId === group.id) {\n\t\t\t\tthis.editor.popFocusLayer()\n\t\t\t}\n\t\t\tthis.editor.reparentShapesById(children, group.parentId)\n\t\t\tthis.editor.deleteShapes([group.id])\n\t\t\treturn\n\t\t}\n\t}\n}\n"],
  "mappings": "AA6EI;AA7EJ,SAAS,OAAO,gBAAuB;AAEvC,SAAS,oBAAoB;AAC7B,SAAS,iBAA4C;AACrD,SAAS,wBAAwB;AAG1B,MAAM,uBAAuB,UAAwB;AAAA,EAC3D,OAAgB,OAAO;AAAA,EAEvB,OAAO;AAAA,EAEP,wBAAwB,MAAM;AAAA,EAC9B,wBAAwB,MAAM;AAAA,EAE9B,UAAU,MAAM;AAAA,EAEhB,eAAsC;AACrC,WAAO,CAAC;AAAA,EACT;AAAA,EAEA,UAAU,OAA4B;AACrC,UAAM,WAAW,KAAK,OAAO,kBAAkB,MAAM,EAAE;AACvD,QAAI,SAAS,WAAW,GAAG;AAC1B,aAAO,IAAI,MAAM;AAAA,IAClB;AAEA,UAAM,iBAAiB,SAAS,QAAQ,CAAC,YAAY;AACpD,YAAMA,SAAQ,KAAK,OAAO,aAAa,OAAO;AAC9C,aAAO,KAAK,OACV,eAAe,OAAO,EACtB,IAAI,CAAC,UAAU,SAAS,aAAa,KAAK,OAAO,aAAaA,MAAK,GAAG,KAAK,CAAC;AAAA,IAC/E,CAAC;AAED,WAAO,MAAM,WAAW,cAAc;AAAA,EACvC;AAAA,EAEA,UAAU,OAA4B;AACrC,WAAO,KAAK,OAAO,KAAK,EAAE;AAAA,EAC3B;AAAA,EAEA,WAAW,OAA8B;AACxC,WAAO,KAAK,OAAO,KAAK,EAAE;AAAA,EAC3B;AAAA,EAEA,UAAU,OAAqB;AAE9B,UAAM;AAAA,MACL;AAAA,MACA,WAAW,EAAE,YAAY,aAAa;AAAA,MACtC;AAAA,IACD,IAAI,KAAK;AAET,UAAM,YAAY,cAAc,IAAI,MAAM,EAAE;AAE5C,UAAM,sBACL,WAAW,SAAS,KACpB,WAAW;AAAA,MACV,CAAC,OACA,OAAO,MAAM,MACb,KAAK,OAAO,cAAc,KAAK,OAAO,aAAa,EAAE,GAAI,cAAc;AAAA,IACzE;AAED;AAAA;AAAA,MAEC,CAAC;AAAA;AAAA,OAGA,MAAM,OAAO,gBAAgB;AAAA,MAC7B;AACD,aAAO;AAAA,IACR;AAEA,UAAM,SAAS,KAAK,OAAO,KAAK;AAEhC,WACC,oBAAC,gBAAa,IAAI,MAAM,IACvB,8BAAC,oBAAiB,WAAU,YAAW,QAAgB,WAAsB,GAC9E;AAAA,EAEF;AAAA,EAEA,UAAU,OAAqB;AAE9B,UAAM;AAAA,MACL,QAAQ,EAAE,GAAG,UAAU;AAAA,IACxB,IAAI,KAAK;AAET,UAAM,SAAS,KAAK,OAAO,KAAK;AAEhC,WAAO,oBAAC,oBAAiB,WAAU,IAAG,QAAgB,WAAsB;AAAA,EAC7E;AAAA,EAEA,mBAA4D,CAAC,UAAU;AACtE,UAAM,WAAW,KAAK,OAAO,kBAAkB,MAAM,EAAE;AACvD,QAAI,SAAS,WAAW,GAAG;AAC1B,UAAI,KAAK,OAAO,UAAU,iBAAiB,MAAM,IAAI;AACpD,aAAK,OAAO,cAAc;AAAA,MAC3B;AACA,WAAK,OAAO,aAAa,CAAC,MAAM,EAAE,CAAC;AACnC;AAAA,IACD,WAAW,SAAS,WAAW,GAAG;AACjC,UAAI,KAAK,OAAO,UAAU,iBAAiB,MAAM,IAAI;AACpD,aAAK,OAAO,cAAc;AAAA,MAC3B;AACA,WAAK,OAAO,mBAAmB,UAAU,MAAM,QAAQ;AACvD,WAAK,OAAO,aAAa,CAAC,MAAM,EAAE,CAAC;AACnC;AAAA,IACD;AAAA,EACD;AACD;",
  "names": ["shape"]
}
