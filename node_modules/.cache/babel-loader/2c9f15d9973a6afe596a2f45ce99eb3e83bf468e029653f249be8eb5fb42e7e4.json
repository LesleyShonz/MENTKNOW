{"ast":null,"code":"import _objectSpread from \"/Users/lesleyshinhiwa/Downloads/tldraw-partykit-example-2/Co/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _slicedToArray from \"/Users/lesleyshinhiwa/Downloads/tldraw-partykit-example-2/Co/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport { Fragment, jsx, jsxs } from \"react/jsx-runtime\";\nimport { MAX_PAGES, useEditor } from \"@tldraw/editor\";\nimport { PageRecordType } from \"@tldraw/tlschema\";\nimport { useCallback, useEffect, useLayoutEffect, useRef, useState } from \"react\";\nimport { useValue } from \"signia-react\";\nimport { useBreakpoint } from \"../../hooks/useBreakpoint.mjs\";\nimport { useMenuIsOpen } from \"../../hooks/useMenuIsOpen.mjs\";\nimport { useTranslation } from \"../../hooks/useTranslation/useTranslation.mjs\";\nimport { Button } from \"../primitives/Button.mjs\";\nimport { Icon } from \"../primitives/Icon.mjs\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"../primitives/Popover.mjs\";\nimport { PageItemInput } from \"./PageItemInput.mjs\";\nimport { PageItemSubmenu } from \"./PageItemSubmenu.mjs\";\nimport { onMovePage } from \"./edit-pages-shared.mjs\";\nvar PageMenu = function PageMenu2() {\n  var editor = useEditor();\n  var msg = useTranslation();\n  var breakpoint = useBreakpoint();\n  var handleOpenChange = useCallback(function () {\n    return setIsEditing(false);\n  }, []);\n  var _useMenuIsOpen = useMenuIsOpen(\"page-menu\", handleOpenChange),\n    _useMenuIsOpen2 = _slicedToArray(_useMenuIsOpen, 2),\n    isOpen = _useMenuIsOpen2[0],\n    onOpenChange = _useMenuIsOpen2[1];\n  var ITEM_HEIGHT = breakpoint < 5 ? 36 : 40;\n  var rSortableContainer = useRef(null);\n  var pages = useValue(\"pages\", function () {\n    return editor.pages;\n  }, [editor]);\n  var currentPage = useValue(\"currentPage\", function () {\n    return editor.currentPage;\n  }, [editor]);\n  var isReadonlyMode = useValue(\"isReadonlyMode\", function () {\n    return editor.isReadOnly;\n  }, [editor]);\n  var maxPageCountReached = useValue(\"maxPageCountReached\", function () {\n    return editor.pages.length >= MAX_PAGES;\n  }, [editor]);\n  var isCoarsePointer = useValue(\"isCoarsePointer\", function () {\n    return editor.isCoarsePointer;\n  }, [editor]);\n  var _useState = useState(false),\n    _useState2 = _slicedToArray(_useState, 2),\n    isEditing = _useState2[0],\n    setIsEditing = _useState2[1];\n  var toggleEditing = useCallback(function () {\n    if (isReadonlyMode) return;\n    setIsEditing(function (s) {\n      return !s;\n    });\n  }, [isReadonlyMode]);\n  var rMutables = useRef({\n    isPointing: false,\n    status: \"idle\",\n    pointing: null,\n    startY: 0,\n    startIndex: 0,\n    dragIndex: 0\n  });\n  var _useState3 = useState(Object.fromEntries(pages.map(function (page, i) {\n      return [page.id, {\n        y: i * ITEM_HEIGHT,\n        offsetY: 0,\n        isSelected: false\n      }];\n    }))),\n    _useState4 = _slicedToArray(_useState3, 2),\n    sortablePositionItems = _useState4[0],\n    setSortablePositionItems = _useState4[1];\n  useLayoutEffect(function () {\n    setSortablePositionItems(Object.fromEntries(pages.map(function (page, i) {\n      return [page.id, {\n        y: i * ITEM_HEIGHT,\n        offsetY: 0,\n        isSelected: false\n      }];\n    })));\n  }, [ITEM_HEIGHT, pages]);\n  useEffect(function () {\n    if (!isOpen) return;\n    requestAnimationFrame(function () {\n      var elm = document.querySelector(\"[data-testid=\\\"page-menu-item-\".concat(currentPage.id, \"\\\"]\"));\n      if (elm) {\n        var container = rSortableContainer.current;\n        if (!container) return;\n        var elmTopPosition = elm.offsetTop;\n        var containerScrollTopPosition = container.scrollTop;\n        if (elmTopPosition < containerScrollTopPosition) {\n          container.scrollTo({\n            top: elmTopPosition\n          });\n        }\n        var elmBottomPosition = elmTopPosition + ITEM_HEIGHT;\n        var containerScrollBottomPosition = container.scrollTop + container.offsetHeight;\n        if (elmBottomPosition > containerScrollBottomPosition) {\n          container.scrollTo({\n            top: elmBottomPosition - container.offsetHeight\n          });\n        }\n      }\n    });\n  }, [ITEM_HEIGHT, currentPage, isOpen]);\n  var handlePointerDown = useCallback(function (e) {\n    var clientY = e.clientY,\n      currentTarget = e.currentTarget;\n    var _currentTarget$datase = currentTarget.dataset,\n      id = _currentTarget$datase.id,\n      index = _currentTarget$datase.index;\n    if (!id || !index) return;\n    var mut = rMutables.current;\n    e.currentTarget.setPointerCapture(e.pointerId);\n    mut.status = \"pointing\";\n    mut.pointing = {\n      id: id,\n      index: +index\n    };\n    var current = sortablePositionItems[id];\n    var dragY = current.y;\n    mut.startY = clientY;\n    mut.startIndex = Math.max(0, Math.min(Math.round(dragY / ITEM_HEIGHT), pages.length - 1));\n  }, [ITEM_HEIGHT, pages.length, sortablePositionItems]);\n  var handlePointerMove = useCallback(function (e) {\n    var mut = rMutables.current;\n    if (mut.status === \"pointing\") {\n      var clientY = e.clientY;\n      var offset = clientY - mut.startY;\n      if (Math.abs(offset) > 5) {\n        mut.status = \"dragging\";\n      }\n    }\n    if (mut.status === \"dragging\") {\n      var _clientY = e.clientY;\n      var offsetY = _clientY - mut.startY;\n      var current = sortablePositionItems[mut.pointing.id];\n      var startIndex = mut.startIndex,\n        pointing = mut.pointing;\n      var dragY = current.y + offsetY;\n      var dragIndex = Math.max(0, Math.min(Math.round(dragY / ITEM_HEIGHT), pages.length - 1));\n      var next = _objectSpread({}, sortablePositionItems);\n      next[pointing.id] = {\n        y: current.y,\n        offsetY: offsetY,\n        isSelected: true\n      };\n      if (dragIndex !== mut.dragIndex) {\n        mut.dragIndex = dragIndex;\n        for (var i = 0; i < pages.length; i++) {\n          var item = pages[i];\n          if (item.id === mut.pointing.id) {\n            continue;\n          }\n          var y = next[item.id].y;\n          if (dragIndex === startIndex) {\n            y = i * ITEM_HEIGHT;\n          } else if (dragIndex < startIndex) {\n            if (dragIndex <= i && i < startIndex) {\n              y = (i + 1) * ITEM_HEIGHT;\n            } else {\n              y = i * ITEM_HEIGHT;\n            }\n          } else if (dragIndex > startIndex) {\n            if (dragIndex >= i && i > startIndex) {\n              y = (i - 1) * ITEM_HEIGHT;\n            } else {\n              y = i * ITEM_HEIGHT;\n            }\n          }\n          if (y !== next[item.id].y) {\n            next[item.id] = {\n              y: y,\n              offsetY: 0,\n              isSelected: true\n            };\n          }\n        }\n      }\n      setSortablePositionItems(next);\n    }\n  }, [ITEM_HEIGHT, pages, sortablePositionItems]);\n  var handlePointerUp = useCallback(function (e) {\n    var mut = rMutables.current;\n    if (mut.status === \"dragging\") {\n      var _mut$pointing = mut.pointing,\n        id = _mut$pointing.id,\n        index = _mut$pointing.index;\n      onMovePage(editor, id, index, mut.dragIndex);\n    }\n    e.currentTarget.releasePointerCapture(e.pointerId);\n    mut.status = \"idle\";\n  }, [editor]);\n  var handleKeyDown = useCallback(function (e) {\n    var mut = rMutables.current;\n    if (e.key === \"Escape\") {\n      if (mut.status === \"dragging\") {\n        setSortablePositionItems(Object.fromEntries(pages.map(function (page, i) {\n          return [page.id, {\n            y: i * ITEM_HEIGHT,\n            offsetY: 0,\n            isSelected: false\n          }];\n        })));\n      }\n      mut.status = \"idle\";\n    }\n  }, [ITEM_HEIGHT, pages]);\n  var handleCreatePageClick = useCallback(function () {\n    if (isReadonlyMode) return;\n    editor.mark(\"creating page\");\n    var newPageId = PageRecordType.createId();\n    editor.createPage(msg(\"page-menu.new-page-initial-name\"), newPageId);\n    setIsEditing(true);\n  }, [editor, msg, isReadonlyMode]);\n  return /* @__PURE__ */jsxs(Popover, {\n    id: \"page menu\",\n    onOpenChange: onOpenChange,\n    open: isOpen,\n    children: [/* @__PURE__ */jsx(PopoverTrigger, {\n      children: /* @__PURE__ */jsx(Button, {\n        className: \"tlui-page-menu__trigger tlui-menu__trigger\",\n        \"data-testid\": \"main.page-menu\",\n        icon: \"chevron-down\",\n        title: currentPage.name,\n        children: /* @__PURE__ */jsx(\"div\", {\n          className: \"tlui-page-menu__name\",\n          children: currentPage.name\n        })\n      })\n    }), /* @__PURE__ */jsx(PopoverContent, {\n      side: \"bottom\",\n      align: \"start\",\n      sideOffset: 6,\n      children: /* @__PURE__ */jsxs(\"div\", {\n        className: \"tlui-page-menu__wrapper\",\n        children: [/* @__PURE__ */jsxs(\"div\", {\n          className: \"tlui-page-menu__header\",\n          children: [/* @__PURE__ */jsx(\"div\", {\n            className: \"tlui-page-menu__header__title\",\n            children: msg(\"page-menu.title\")\n          }), !isReadonlyMode && /* @__PURE__ */jsxs(Fragment, {\n            children: [/* @__PURE__ */jsx(Button, {\n              \"data-testid\": \"page-menu.edit\",\n              title: msg(isEditing ? \"page-menu.edit-done\" : \"page-menu.edit-start\"),\n              icon: isEditing ? \"check\" : \"edit\",\n              onClick: toggleEditing\n            }), /* @__PURE__ */jsx(Button, {\n              \"data-testid\": \"page-menu.create\",\n              icon: \"plus\",\n              title: msg(maxPageCountReached ? \"page-menu.max-page-count-reached\" : \"page-menu.create-new-page\"),\n              disabled: maxPageCountReached,\n              onClick: handleCreatePageClick\n            })]\n          })]\n        }), /* @__PURE__ */jsx(\"div\", {\n          className: \"tlui-page-menu__list tlui-menu__group\",\n          style: {\n            height: ITEM_HEIGHT * pages.length + 4\n          },\n          ref: rSortableContainer,\n          children: pages.map(function (page, index) {\n            var _sortablePositionItem;\n            var position = (_sortablePositionItem = sortablePositionItems[page.id]) !== null && _sortablePositionItem !== void 0 ? _sortablePositionItem : {\n              position: index * 40,\n              offsetY: 0\n            };\n            return isEditing ? /* @__PURE__ */jsxs(\"div\", {\n              \"data-testid\": \"page-menu-item-\".concat(page.id),\n              className: \"tlui-page_menu__item__sortable\",\n              style: {\n                zIndex: page.id === currentPage.id ? 888 : index,\n                transform: \"translate(0px, \".concat(position.y + position.offsetY, \"px)\")\n              },\n              children: [/* @__PURE__ */jsx(Button, {\n                tabIndex: -1,\n                className: \"tlui-page_menu__item__sortable__handle\",\n                icon: \"drag-handle-dots\",\n                onPointerDown: handlePointerDown,\n                onPointerUp: handlePointerUp,\n                onPointerMove: handlePointerMove,\n                onKeyDown: handleKeyDown,\n                \"data-id\": page.id,\n                \"data-index\": index\n              }), breakpoint < 5 && isCoarsePointer ?\n              // sigh, this is a workaround for iOS Safari\n              // because the device and the radix popover seem\n              // to be fighting over scroll position. Nothing\n              // else seems to work!\n              /* @__PURE__ */\n              jsx(Button, {\n                className: \"tlui-page-menu__item__button\",\n                onClick: function onClick() {\n                  var name = window.prompt(\"Rename page\", page.name);\n                  if (name && name !== page.name) {\n                    editor.renamePage(page.id, name);\n                  }\n                },\n                onDoubleClick: toggleEditing,\n                isChecked: page.id === currentPage.id,\n                children: /* @__PURE__ */jsx(\"span\", {\n                  children: page.name\n                })\n              }) : /* @__PURE__ */jsx(\"div\", {\n                id: \"page-menu-item-\".concat(page.id),\n                \"data-testid\": \"page-menu-item-\".concat(page.id),\n                className: \"tlui-page_menu__item__sortable__title\",\n                style: {\n                  height: ITEM_HEIGHT\n                },\n                children: /* @__PURE__ */jsx(PageItemInput, {\n                  id: page.id,\n                  name: page.name,\n                  isCurrentPage: page.id === currentPage.id\n                })\n              }), !isReadonlyMode && /* @__PURE__ */jsx(\"div\", {\n                className: \"tlui-page_menu__item__submenu\",\n                \"data-isediting\": isEditing,\n                children: /* @__PURE__ */jsx(PageItemSubmenu, {\n                  index: index,\n                  item: page,\n                  listSize: pages.length\n                })\n              })]\n            }, page.id + \"_editing\") : /* @__PURE__ */jsxs(\"div\", {\n              \"data-testid\": \"page-menu-item-\".concat(page.id),\n              className: \"tlui-page-menu__item\",\n              children: [/* @__PURE__ */jsxs(Button, {\n                className: \"tlui-page-menu__item__button tlui-page-menu__item__button__checkbox\",\n                onClick: function onClick() {\n                  return editor.setCurrentPageId(page.id);\n                },\n                onDoubleClick: toggleEditing,\n                isChecked: page.id === currentPage.id,\n                title: msg(\"page-menu.go-to-page\"),\n                children: [/* @__PURE__ */jsx(\"div\", {\n                  className: \"tlui-page-menu__item__button__check\",\n                  children: page.id === currentPage.id && /* @__PURE__ */jsx(Icon, {\n                    icon: \"check\"\n                  })\n                }), /* @__PURE__ */jsx(\"span\", {\n                  children: page.name\n                })]\n              }), !isReadonlyMode && /* @__PURE__ */jsx(\"div\", {\n                className: \"tlui-page_menu__item__submenu\",\n                children: /* @__PURE__ */jsx(PageItemSubmenu, {\n                  index: index,\n                  item: page,\n                  listSize: pages.length,\n                  onRename: function onRename() {\n                    if (editor.isIos) {\n                      var name = window.prompt(\"Rename page\", page.name);\n                      if (name && name !== page.name) {\n                        editor.renamePage(page.id, name);\n                      }\n                    } else {\n                      setIsEditing(true);\n                      editor.setCurrentPageId(page.id);\n                    }\n                  }\n                })\n              })]\n            }, page.id);\n          })\n        })]\n      })\n    })]\n  });\n};\nexport { PageMenu };","map":{"version":3,"names":["Fragment","jsx","jsxs","MAX_PAGES","useEditor","PageRecordType","useCallback","useEffect","useLayoutEffect","useRef","useState","useValue","useBreakpoint","useMenuIsOpen","useTranslation","Button","Icon","Popover","PopoverContent","PopoverTrigger","PageItemInput","PageItemSubmenu","onMovePage","PageMenu","PageMenu2","editor","msg","breakpoint","handleOpenChange","setIsEditing","_useMenuIsOpen","_useMenuIsOpen2","_slicedToArray","isOpen","onOpenChange","ITEM_HEIGHT","rSortableContainer","pages","currentPage","isReadonlyMode","isReadOnly","maxPageCountReached","length","isCoarsePointer","_useState","_useState2","isEditing","toggleEditing","s","rMutables","isPointing","status","pointing","startY","startIndex","dragIndex","_useState3","Object","fromEntries","map","page","i","id","y","offsetY","isSelected","_useState4","sortablePositionItems","setSortablePositionItems","requestAnimationFrame","elm","document","querySelector","concat","container","current","elmTopPosition","offsetTop","containerScrollTopPosition","scrollTop","scrollTo","top","elmBottomPosition","containerScrollBottomPosition","offsetHeight","handlePointerDown","e","clientY","currentTarget","_currentTarget$datase","dataset","index","mut","setPointerCapture","pointerId","dragY","Math","max","min","round","handlePointerMove","offset","abs","next","_objectSpread","item","handlePointerUp","_mut$pointing","releasePointerCapture","handleKeyDown","key","handleCreatePageClick","mark","newPageId","createId","createPage","open","children","className","icon","title","name","side","align","sideOffset","onClick","disabled","style","height","ref","_sortablePositionItem","position","zIndex","transform","tabIndex","onPointerDown","onPointerUp","onPointerMove","onKeyDown","window","prompt","renamePage","onDoubleClick","isChecked","isCurrentPage","listSize","setCurrentPageId","onRename","isIos"],"sources":["/Users/lesleyshinhiwa/Downloads/tldraw-partykit-example-2/Co/node_modules/@tldraw/ui/src/lib/components/PageMenu/PageMenu.tsx"],"sourcesContent":["import { MAX_PAGES, useEditor } from '@tldraw/editor'\nimport { PageRecordType, TLPageId } from '@tldraw/tlschema'\nimport { useCallback, useEffect, useLayoutEffect, useRef, useState } from 'react'\nimport { useValue } from 'signia-react'\nimport { useBreakpoint } from '../../hooks/useBreakpoint'\nimport { useMenuIsOpen } from '../../hooks/useMenuIsOpen'\nimport { useTranslation } from '../../hooks/useTranslation/useTranslation'\nimport { Button } from '../primitives/Button'\nimport { Icon } from '../primitives/Icon'\nimport { Popover, PopoverContent, PopoverTrigger } from '../primitives/Popover'\nimport { PageItemInput } from './PageItemInput'\nimport { PageItemSubmenu } from './PageItemSubmenu'\nimport { onMovePage } from './edit-pages-shared'\n\nexport const PageMenu = function PageMenu() {\n\tconst editor = useEditor()\n\tconst msg = useTranslation()\n\tconst breakpoint = useBreakpoint()\n\n\tconst handleOpenChange = useCallback(() => setIsEditing(false), [])\n\n\tconst [isOpen, onOpenChange] = useMenuIsOpen('page-menu', handleOpenChange)\n\n\tconst ITEM_HEIGHT = breakpoint < 5 ? 36 : 40\n\n\tconst rSortableContainer = useRef<HTMLDivElement>(null)\n\n\tconst pages = useValue('pages', () => editor.pages, [editor])\n\tconst currentPage = useValue('currentPage', () => editor.currentPage, [editor])\n\n\t// When in readonly mode, we don't allow a user to edit the pages\n\tconst isReadonlyMode = useValue('isReadonlyMode', () => editor.isReadOnly, [editor])\n\n\t// If the user has reached the max page count, we disable the \"add page\" button\n\tconst maxPageCountReached = useValue(\n\t\t'maxPageCountReached',\n\t\t() => editor.pages.length >= MAX_PAGES,\n\t\t[editor]\n\t)\n\n\tconst isCoarsePointer = useValue('isCoarsePointer', () => editor.isCoarsePointer, [editor])\n\n\t// The component has an \"editing state\" that may be toggled to expose additional controls\n\tconst [isEditing, setIsEditing] = useState(false)\n\n\tconst toggleEditing = useCallback(() => {\n\t\tif (isReadonlyMode) return\n\t\tsetIsEditing((s) => !s)\n\t}, [isReadonlyMode])\n\n\tconst rMutables = useRef({\n\t\tisPointing: false,\n\t\tstatus: 'idle' as 'idle' | 'pointing' | 'dragging',\n\t\tpointing: null as { id: string; index: number } | null,\n\t\tstartY: 0,\n\t\tstartIndex: 0,\n\t\tdragIndex: 0,\n\t})\n\n\tconst [sortablePositionItems, setSortablePositionItems] = useState(\n\t\tObject.fromEntries(\n\t\t\tpages.map((page, i) => [page.id, { y: i * ITEM_HEIGHT, offsetY: 0, isSelected: false }])\n\t\t)\n\t)\n\n\t// Update the sortable position items when the pages change\n\tuseLayoutEffect(() => {\n\t\tsetSortablePositionItems(\n\t\t\tObject.fromEntries(\n\t\t\t\tpages.map((page, i) => [page.id, { y: i * ITEM_HEIGHT, offsetY: 0, isSelected: false }])\n\t\t\t)\n\t\t)\n\t}, [ITEM_HEIGHT, pages])\n\n\t// Scroll the current page into view when the menu opens / when current page changes\n\tuseEffect(() => {\n\t\tif (!isOpen) return\n\t\trequestAnimationFrame(() => {\n\t\t\tconst elm = document.querySelector(\n\t\t\t\t`[data-testid=\"page-menu-item-${currentPage.id}\"]`\n\t\t\t) as HTMLDivElement\n\n\t\t\tif (elm) {\n\t\t\t\tconst container = rSortableContainer.current\n\t\t\t\tif (!container) return\n\t\t\t\t// Scroll into view is slightly borked on iOS Safari\n\n\t\t\t\t// if top of less than top cuttoff, scroll into view at top\n\t\t\t\tconst elmTopPosition = elm.offsetTop\n\t\t\t\tconst containerScrollTopPosition = container.scrollTop\n\t\t\t\tif (elmTopPosition < containerScrollTopPosition) {\n\t\t\t\t\tcontainer.scrollTo({ top: elmTopPosition })\n\t\t\t\t}\n\t\t\t\t// if bottom position is greater than bottom cutoff, scroll into view at bottom\n\t\t\t\tconst elmBottomPosition = elmTopPosition + ITEM_HEIGHT\n\t\t\t\tconst containerScrollBottomPosition = container.scrollTop + container.offsetHeight\n\t\t\t\tif (elmBottomPosition > containerScrollBottomPosition) {\n\t\t\t\t\tcontainer.scrollTo({ top: elmBottomPosition - container.offsetHeight })\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}, [ITEM_HEIGHT, currentPage, isOpen])\n\n\tconst handlePointerDown = useCallback(\n\t\t(e: React.PointerEvent<HTMLButtonElement>) => {\n\t\t\tconst { clientY, currentTarget } = e\n\t\t\tconst {\n\t\t\t\tdataset: { id, index },\n\t\t\t} = currentTarget\n\n\t\t\tif (!id || !index) return\n\n\t\t\tconst mut = rMutables.current\n\n\t\t\te.currentTarget.setPointerCapture(e.pointerId)\n\n\t\t\tmut.status = 'pointing'\n\t\t\tmut.pointing = { id, index: +index! }\n\t\t\tconst current = sortablePositionItems[id]\n\t\t\tconst dragY = current.y\n\n\t\t\tmut.startY = clientY\n\t\t\tmut.startIndex = Math.max(0, Math.min(Math.round(dragY / ITEM_HEIGHT), pages.length - 1))\n\t\t},\n\t\t[ITEM_HEIGHT, pages.length, sortablePositionItems]\n\t)\n\n\tconst handlePointerMove = useCallback(\n\t\t(e: React.PointerEvent<HTMLButtonElement>) => {\n\t\t\tconst mut = rMutables.current\n\t\t\tif (mut.status === 'pointing') {\n\t\t\t\tconst { clientY } = e\n\t\t\t\tconst offset = clientY - mut.startY\n\t\t\t\tif (Math.abs(offset) > 5) {\n\t\t\t\t\tmut.status = 'dragging'\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (mut.status === 'dragging') {\n\t\t\t\tconst { clientY } = e\n\t\t\t\tconst offsetY = clientY - mut.startY\n\t\t\t\tconst current = sortablePositionItems[mut.pointing!.id]\n\n\t\t\t\tconst { startIndex, pointing } = mut\n\t\t\t\tconst dragY = current.y + offsetY\n\t\t\t\tconst dragIndex = Math.max(0, Math.min(Math.round(dragY / ITEM_HEIGHT), pages.length - 1))\n\n\t\t\t\tconst next = { ...sortablePositionItems }\n\t\t\t\tnext[pointing!.id] = {\n\t\t\t\t\ty: current.y,\n\t\t\t\t\toffsetY,\n\t\t\t\t\tisSelected: true,\n\t\t\t\t}\n\n\t\t\t\tif (dragIndex !== mut.dragIndex) {\n\t\t\t\t\tmut.dragIndex = dragIndex\n\n\t\t\t\t\tfor (let i = 0; i < pages.length; i++) {\n\t\t\t\t\t\tconst item = pages[i]\n\t\t\t\t\t\tif (item.id === mut.pointing!.id) {\n\t\t\t\t\t\t\tcontinue\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet { y } = next[item.id]\n\n\t\t\t\t\t\tif (dragIndex === startIndex) {\n\t\t\t\t\t\t\ty = i * ITEM_HEIGHT\n\t\t\t\t\t\t} else if (dragIndex < startIndex) {\n\t\t\t\t\t\t\tif (dragIndex <= i && i < startIndex) {\n\t\t\t\t\t\t\t\ty = (i + 1) * ITEM_HEIGHT\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\ty = i * ITEM_HEIGHT\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (dragIndex > startIndex) {\n\t\t\t\t\t\t\tif (dragIndex >= i && i > startIndex) {\n\t\t\t\t\t\t\t\ty = (i - 1) * ITEM_HEIGHT\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\ty = i * ITEM_HEIGHT\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (y !== next[item.id].y) {\n\t\t\t\t\t\t\tnext[item.id] = { y, offsetY: 0, isSelected: true }\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tsetSortablePositionItems(next)\n\t\t\t}\n\t\t},\n\t\t[ITEM_HEIGHT, pages, sortablePositionItems]\n\t)\n\n\tconst handlePointerUp = useCallback(\n\t\t(e: React.PointerEvent<HTMLButtonElement>) => {\n\t\t\tconst mut = rMutables.current\n\n\t\t\tif (mut.status === 'dragging') {\n\t\t\t\tconst { id, index } = mut.pointing!\n\t\t\t\tonMovePage(editor, id as TLPageId, index, mut.dragIndex)\n\t\t\t}\n\n\t\t\te.currentTarget.releasePointerCapture(e.pointerId)\n\t\t\tmut.status = 'idle'\n\t\t},\n\t\t[editor]\n\t)\n\n\tconst handleKeyDown = useCallback(\n\t\t(e: React.KeyboardEvent<HTMLButtonElement>) => {\n\t\t\tconst mut = rMutables.current\n\t\t\t// bail on escape\n\t\t\tif (e.key === 'Escape') {\n\t\t\t\tif (mut.status === 'dragging') {\n\t\t\t\t\tsetSortablePositionItems(\n\t\t\t\t\t\tObject.fromEntries(\n\t\t\t\t\t\t\tpages.map((page, i) => [\n\t\t\t\t\t\t\t\tpage.id,\n\t\t\t\t\t\t\t\t{ y: i * ITEM_HEIGHT, offsetY: 0, isSelected: false },\n\t\t\t\t\t\t\t])\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t}\n\n\t\t\t\tmut.status = 'idle'\n\t\t\t}\n\t\t},\n\t\t[ITEM_HEIGHT, pages]\n\t)\n\n\tconst handleCreatePageClick = useCallback(() => {\n\t\tif (isReadonlyMode) return\n\n\t\teditor.mark('creating page')\n\t\tconst newPageId = PageRecordType.createId()\n\t\teditor.createPage(msg('page-menu.new-page-initial-name'), newPageId)\n\t\tsetIsEditing(true)\n\t}, [editor, msg, isReadonlyMode])\n\n\treturn (\n\t\t<Popover id=\"page menu\" onOpenChange={onOpenChange} open={isOpen}>\n\t\t\t<PopoverTrigger>\n\t\t\t\t<Button\n\t\t\t\t\tclassName=\"tlui-page-menu__trigger tlui-menu__trigger\"\n\t\t\t\t\tdata-testid=\"main.page-menu\"\n\t\t\t\t\ticon=\"chevron-down\"\n\t\t\t\t\ttitle={currentPage.name}\n\t\t\t\t>\n\t\t\t\t\t<div className=\"tlui-page-menu__name\">{currentPage.name}</div>\n\t\t\t\t</Button>\n\t\t\t</PopoverTrigger>\n\t\t\t<PopoverContent side=\"bottom\" align=\"start\" sideOffset={6}>\n\t\t\t\t<div className=\"tlui-page-menu__wrapper\">\n\t\t\t\t\t<div className=\"tlui-page-menu__header\">\n\t\t\t\t\t\t<div className=\"tlui-page-menu__header__title\">{msg('page-menu.title')}</div>\n\t\t\t\t\t\t{!isReadonlyMode && (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tdata-testid=\"page-menu.edit\"\n\t\t\t\t\t\t\t\t\ttitle={msg(isEditing ? 'page-menu.edit-done' : 'page-menu.edit-start')}\n\t\t\t\t\t\t\t\t\ticon={isEditing ? 'check' : 'edit'}\n\t\t\t\t\t\t\t\t\tonClick={toggleEditing}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tdata-testid=\"page-menu.create\"\n\t\t\t\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\t\t\t\ttitle={msg(\n\t\t\t\t\t\t\t\t\t\tmaxPageCountReached\n\t\t\t\t\t\t\t\t\t\t\t? 'page-menu.max-page-count-reached'\n\t\t\t\t\t\t\t\t\t\t\t: 'page-menu.create-new-page'\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\tdisabled={maxPageCountReached}\n\t\t\t\t\t\t\t\t\tonClick={handleCreatePageClick}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName=\"tlui-page-menu__list tlui-menu__group\"\n\t\t\t\t\t\tstyle={{ height: ITEM_HEIGHT * pages.length + 4 }}\n\t\t\t\t\t\tref={rSortableContainer}\n\t\t\t\t\t>\n\t\t\t\t\t\t{pages.map((page, index) => {\n\t\t\t\t\t\t\tconst position = sortablePositionItems[page.id] ?? {\n\t\t\t\t\t\t\t\tposition: index * 40,\n\t\t\t\t\t\t\t\toffsetY: 0,\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn isEditing ? (\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tkey={page.id + '_editing'}\n\t\t\t\t\t\t\t\t\tdata-testid={`page-menu-item-${page.id}`}\n\t\t\t\t\t\t\t\t\tclassName=\"tlui-page_menu__item__sortable\"\n\t\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\t\tzIndex: page.id === currentPage.id ? 888 : index,\n\t\t\t\t\t\t\t\t\t\ttransform: `translate(0px, ${position.y + position.offsetY}px)`,\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\ttabIndex={-1}\n\t\t\t\t\t\t\t\t\t\tclassName=\"tlui-page_menu__item__sortable__handle\"\n\t\t\t\t\t\t\t\t\t\ticon=\"drag-handle-dots\"\n\t\t\t\t\t\t\t\t\t\tonPointerDown={handlePointerDown}\n\t\t\t\t\t\t\t\t\t\tonPointerUp={handlePointerUp}\n\t\t\t\t\t\t\t\t\t\tonPointerMove={handlePointerMove}\n\t\t\t\t\t\t\t\t\t\tonKeyDown={handleKeyDown}\n\t\t\t\t\t\t\t\t\t\tdata-id={page.id}\n\t\t\t\t\t\t\t\t\t\tdata-index={index}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t{breakpoint < 5 && isCoarsePointer ? (\n\t\t\t\t\t\t\t\t\t\t// sigh, this is a workaround for iOS Safari\n\t\t\t\t\t\t\t\t\t\t// because the device and the radix popover seem\n\t\t\t\t\t\t\t\t\t\t// to be fighting over scroll position. Nothing\n\t\t\t\t\t\t\t\t\t\t// else seems to work!\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"tlui-page-menu__item__button\"\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\t\t\tconst name = window.prompt('Rename page', page.name)\n\t\t\t\t\t\t\t\t\t\t\t\tif (name && name !== page.name) {\n\t\t\t\t\t\t\t\t\t\t\t\t\teditor.renamePage(page.id, name)\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\tonDoubleClick={toggleEditing}\n\t\t\t\t\t\t\t\t\t\t\tisChecked={page.id === currentPage.id}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<span>{page.name}</span>\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tid={`page-menu-item-${page.id}`}\n\t\t\t\t\t\t\t\t\t\t\tdata-testid={`page-menu-item-${page.id}`}\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"tlui-page_menu__item__sortable__title\"\n\t\t\t\t\t\t\t\t\t\t\tstyle={{ height: ITEM_HEIGHT }}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<PageItemInput\n\t\t\t\t\t\t\t\t\t\t\t\tid={page.id}\n\t\t\t\t\t\t\t\t\t\t\t\tname={page.name}\n\t\t\t\t\t\t\t\t\t\t\t\tisCurrentPage={page.id === currentPage.id}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t{!isReadonlyMode && (\n\t\t\t\t\t\t\t\t\t\t<div className=\"tlui-page_menu__item__submenu\" data-isediting={isEditing}>\n\t\t\t\t\t\t\t\t\t\t\t<PageItemSubmenu index={index} item={page} listSize={pages.length} />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tkey={page.id}\n\t\t\t\t\t\t\t\t\tdata-testid={`page-menu-item-${page.id}`}\n\t\t\t\t\t\t\t\t\tclassName=\"tlui-page-menu__item\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tclassName=\"tlui-page-menu__item__button tlui-page-menu__item__button__checkbox\"\n\t\t\t\t\t\t\t\t\t\tonClick={() => editor.setCurrentPageId(page.id)}\n\t\t\t\t\t\t\t\t\t\tonDoubleClick={toggleEditing}\n\t\t\t\t\t\t\t\t\t\tisChecked={page.id === currentPage.id}\n\t\t\t\t\t\t\t\t\t\ttitle={msg('page-menu.go-to-page')}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<div className=\"tlui-page-menu__item__button__check\">\n\t\t\t\t\t\t\t\t\t\t\t{page.id === currentPage.id && <Icon icon=\"check\" />}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<span>{page.name}</span>\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t{!isReadonlyMode && (\n\t\t\t\t\t\t\t\t\t\t<div className=\"tlui-page_menu__item__submenu\">\n\t\t\t\t\t\t\t\t\t\t\t<PageItemSubmenu\n\t\t\t\t\t\t\t\t\t\t\t\tindex={index}\n\t\t\t\t\t\t\t\t\t\t\t\titem={page}\n\t\t\t\t\t\t\t\t\t\t\t\tlistSize={pages.length}\n\t\t\t\t\t\t\t\t\t\t\t\tonRename={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (editor.isIos) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst name = window.prompt('Rename page', page.name)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (name && name !== page.name) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\teditor.renamePage(page.id, name)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetIsEditing(true)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\teditor.setCurrentPageId(page.id)\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t})}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</PopoverContent>\n\t\t</Popover>\n\t)\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}