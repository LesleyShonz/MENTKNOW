{"ast":null,"code":"import _createClass from \"/Users/lesleyshinhiwa/Downloads/tldraw-partykit-example-2/Co/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _classCallCheck from \"/Users/lesleyshinhiwa/Downloads/tldraw-partykit-example-2/Co/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _defineProperty from \"/Users/lesleyshinhiwa/Downloads/tldraw-partykit-example-2/Co/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport { Vec2d } from \"@tldraw/primitives\";\nvar TickManager = /*#__PURE__*/_createClass(function TickManager(editor) {\n  var _this = this;\n  _classCallCheck(this, TickManager);\n  _defineProperty(this, \"raf\", void 0);\n  _defineProperty(this, \"isPaused\", true);\n  _defineProperty(this, \"last\", 0);\n  _defineProperty(this, \"t\", 0);\n  _defineProperty(this, \"start\", function () {\n    _this.isPaused = false;\n    cancelAnimationFrame(_this.raf);\n    _this.raf = requestAnimationFrame(_this.tick);\n    _this.last = Date.now();\n  });\n  _defineProperty(this, \"tick\", function () {\n    if (_this.isPaused) {\n      return;\n    }\n    var now = Date.now();\n    var elapsed = now - _this.last;\n    _this.last = now;\n    _this.t += elapsed;\n    _this.editor.emit(\"frame\", elapsed);\n    if (_this.t < 16) {\n      _this.raf = requestAnimationFrame(_this.tick);\n      return;\n    }\n    _this.t -= 16;\n    _this.updatePointerVelocity(elapsed);\n    _this.editor.emit(\"tick\", elapsed);\n    _this.raf = requestAnimationFrame(_this.tick);\n  });\n  // Clear the listener\n  _defineProperty(this, \"dispose\", function () {\n    _this.isPaused = true;\n    cancelAnimationFrame(_this.raf);\n  });\n  _defineProperty(this, \"prevPoint\", new Vec2d());\n  _defineProperty(this, \"updatePointerVelocity\", function (elapsed) {\n    var prevPoint = _this.prevPoint,\n      _this$editor$inputs = _this.editor.inputs,\n      currentScreenPoint = _this$editor$inputs.currentScreenPoint,\n      pointerVelocity = _this$editor$inputs.pointerVelocity;\n    if (elapsed === 0) return;\n    var delta = Vec2d.Sub(currentScreenPoint, prevPoint);\n    _this.prevPoint = currentScreenPoint.clone();\n    var length = delta.len();\n    var direction = length ? delta.div(length) : new Vec2d(0, 0);\n    var next = pointerVelocity.clone().lrp(direction.mul(length / elapsed), 0.5);\n    if (Math.abs(next.x) < 0.01) next.x = 0;\n    if (Math.abs(next.y) < 0.01) next.y = 0;\n    if (!pointerVelocity.equals(next)) {\n      _this.editor.inputs.pointerVelocity = next;\n    }\n  });\n  this.editor = editor;\n  this.editor.disposables.add(this.dispose);\n  this.start();\n});\nexport { TickManager };","map":{"version":3,"names":["Vec2d","TickManager","_createClass","editor","_this","_classCallCheck","_defineProperty","isPaused","cancelAnimationFrame","raf","requestAnimationFrame","tick","last","Date","now","elapsed","t","emit","updatePointerVelocity","prevPoint","_this$editor$inputs","inputs","currentScreenPoint","pointerVelocity","delta","Sub","clone","length","len","direction","div","next","lrp","mul","Math","abs","x","y","equals","disposables","add","dispose","start"],"sources":["/Users/lesleyshinhiwa/Downloads/tldraw-partykit-example-2/Co/node_modules/@tldraw/editor/src/lib/editor/managers/TickManager.ts"],"sourcesContent":["import { Vec2d } from '@tldraw/primitives'\nimport { Editor } from '../Editor'\n\nexport class TickManager {\n\tconstructor(public editor: Editor) {\n\t\tthis.editor.disposables.add(this.dispose)\n\t\tthis.start()\n\t}\n\n\traf: any\n\tisPaused = true\n\tlast = 0\n\tt = 0\n\n\tstart = () => {\n\t\tthis.isPaused = false\n\t\tcancelAnimationFrame(this.raf)\n\t\tthis.raf = requestAnimationFrame(this.tick)\n\t\tthis.last = Date.now()\n\t}\n\n\ttick = () => {\n\t\tif (this.isPaused) {\n\t\t\treturn\n\t\t}\n\n\t\tconst now = Date.now()\n\t\tconst elapsed = now - this.last\n\t\tthis.last = now\n\t\tthis.t += elapsed\n\n\t\tthis.editor.emit('frame', elapsed)\n\n\t\tif (this.t < 16) {\n\t\t\tthis.raf = requestAnimationFrame(this.tick)\n\t\t\treturn\n\t\t}\n\n\t\tthis.t -= 16\n\t\tthis.updatePointerVelocity(elapsed)\n\t\tthis.editor.emit('tick', elapsed)\n\t\tthis.raf = requestAnimationFrame(this.tick)\n\t}\n\n\t// Clear the listener\n\tdispose = () => {\n\t\tthis.isPaused = true\n\t\tcancelAnimationFrame(this.raf)\n\t}\n\n\tprivate prevPoint = new Vec2d()\n\n\tprivate updatePointerVelocity = (elapsed: number) => {\n\t\tconst {\n\t\t\tprevPoint,\n\t\t\teditor: {\n\t\t\t\tinputs: { currentScreenPoint, pointerVelocity },\n\t\t\t},\n\t\t} = this\n\n\t\tif (elapsed === 0) return\n\n\t\tconst delta = Vec2d.Sub(currentScreenPoint, prevPoint)\n\t\tthis.prevPoint = currentScreenPoint.clone()\n\n\t\tconst length = delta.len()\n\t\tconst direction = length ? delta.div(length) : new Vec2d(0, 0)\n\n\t\t// consider adjusting this with an easing rather than a linear interpolation\n\t\tconst next = pointerVelocity.clone().lrp(direction.mul(length / elapsed), 0.5)\n\n\t\t// if the velocity is very small, just set it to 0\n\t\tif (Math.abs(next.x) < 0.01) next.x = 0\n\t\tif (Math.abs(next.y) < 0.01) next.y = 0\n\n\t\tif (!pointerVelocity.equals(next)) {\n\t\t\tthis.editor.inputs.pointerVelocity = next\n\t\t}\n\t}\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}