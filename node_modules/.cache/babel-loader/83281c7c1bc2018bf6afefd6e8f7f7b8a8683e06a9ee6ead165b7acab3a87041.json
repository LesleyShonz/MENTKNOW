{"ast":null,"code":"import _slicedToArray from \"/Users/lesleyshinhiwa/Downloads/tldraw-partykit-example-2/Co/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport { Fragment, jsx, jsxs } from \"react/jsx-runtime\";\nimport { useEffect, useRef, useState } from \"react\";\nimport { track } from \"signia-react\";\nimport { COLLABORATOR_CHECK_INTERVAL, COLLABORATOR_TIMEOUT } from \"../constants.mjs\";\nimport { useEditor } from \"../hooks/useEditor.mjs\";\nimport { useEditorComponents } from \"../hooks/useEditorComponents.mjs\";\nimport { usePeerIds } from \"../hooks/usePeerIds.mjs\";\nimport { usePresence } from \"../hooks/usePresence.mjs\";\nvar LiveCollaborators = track(function Collaborators() {\n  var peerIds = usePeerIds();\n  return /* @__PURE__ */jsx(Fragment, {\n    children: peerIds.map(function (id) {\n      return /* @__PURE__ */jsx(Collaborator, {\n        userId: id\n      }, id);\n    })\n  });\n});\nvar Collaborator = track(function Collaborator2(_ref) {\n  var userId = _ref.userId;\n  var editor = useEditor();\n  var viewportPageBounds = editor.viewportPageBounds,\n    zoomLevel = editor.zoomLevel;\n  var _useEditorComponents = useEditorComponents(),\n    CollaboratorBrush = _useEditorComponents.CollaboratorBrush,\n    CollaboratorScribble = _useEditorComponents.CollaboratorScribble,\n    CollaboratorCursor = _useEditorComponents.CollaboratorCursor,\n    CollaboratorHint = _useEditorComponents.CollaboratorHint,\n    CollaboratorShapeIndicator = _useEditorComponents.CollaboratorShapeIndicator;\n  var latestPresence = usePresence(userId);\n  var _useState = useState(false),\n    _useState2 = _slicedToArray(_useState, 2),\n    isTimedOut = _useState2[0],\n    setIsTimedOut = _useState2[1];\n  var rLastSeen = useRef(-1);\n  useEffect(function () {\n    var interval = setInterval(function () {\n      setIsTimedOut(Date.now() - rLastSeen.current > COLLABORATOR_TIMEOUT);\n    }, COLLABORATOR_CHECK_INTERVAL);\n    return function () {\n      return clearInterval(interval);\n    };\n  }, []);\n  if (!latestPresence) return null;\n  rLastSeen.current = latestPresence.lastActivityTimestamp;\n  if (isTimedOut && editor.instanceState.followingUserId !== userId && !editor.instanceState.highlightedUserIds.includes(userId)) return null;\n  if (latestPresence.currentPageId !== editor.currentPageId) return null;\n  var brush = latestPresence.brush,\n    scribble = latestPresence.scribble,\n    selectedIds = latestPresence.selectedIds,\n    userName = latestPresence.userName,\n    cursor = latestPresence.cursor,\n    color = latestPresence.color,\n    chatMessage = latestPresence.chatMessage;\n  var isCursorInViewport = !(cursor.x < viewportPageBounds.minX - 12 / zoomLevel || cursor.y < viewportPageBounds.minY - 16 / zoomLevel || cursor.x > viewportPageBounds.maxX - 12 / zoomLevel || cursor.y > viewportPageBounds.maxY - 16 / zoomLevel);\n  return /* @__PURE__ */jsxs(Fragment, {\n    children: [brush && CollaboratorBrush ? /* @__PURE__ */jsx(CollaboratorBrush, {\n      className: \"tl-collaborator__brush\",\n      brush: brush,\n      color: color,\n      opacity: 0.1\n    }, userId + \"_brush\") : null, isCursorInViewport && CollaboratorCursor ? /* @__PURE__ */jsx(CollaboratorCursor, {\n      className: \"tl-collaborator__cursor\",\n      point: cursor,\n      color: color,\n      zoom: zoomLevel,\n      name: userName !== \"New User\" ? userName : null,\n      chatMessage: chatMessage\n    }, userId + \"_cursor\") : CollaboratorHint ? /* @__PURE__ */jsx(CollaboratorHint, {\n      className: \"tl-collaborator__cursor-hint\",\n      point: cursor,\n      color: color,\n      zoom: zoomLevel,\n      viewport: viewportPageBounds\n    }, userId + \"_cursor_hint\") : null, scribble && CollaboratorScribble ? /* @__PURE__ */jsx(CollaboratorScribble, {\n      className: \"tl-collaborator__scribble\",\n      scribble: scribble,\n      color: color,\n      zoom: zoomLevel,\n      opacity: scribble.color === \"laser\" ? 0.5 : 0.1\n    }, userId + \"_scribble\") : null, CollaboratorShapeIndicator && selectedIds.map(function (shapeId) {\n      return /* @__PURE__ */jsx(CollaboratorShapeIndicator, {\n        className: \"tl-collaborator__shape-indicator\",\n        id: shapeId,\n        color: color,\n        opacity: 0.5\n      }, userId + \"_\" + shapeId);\n    })]\n  });\n});\nexport { LiveCollaborators };","map":{"version":3,"names":["Fragment","jsx","jsxs","useEffect","useRef","useState","track","COLLABORATOR_CHECK_INTERVAL","COLLABORATOR_TIMEOUT","useEditor","useEditorComponents","usePeerIds","usePresence","LiveCollaborators","Collaborators","peerIds","children","map","id","Collaborator","userId","Collaborator2","_ref","editor","viewportPageBounds","zoomLevel","_useEditorComponents","CollaboratorBrush","CollaboratorScribble","CollaboratorCursor","CollaboratorHint","CollaboratorShapeIndicator","latestPresence","_useState","_useState2","_slicedToArray","isTimedOut","setIsTimedOut","rLastSeen","interval","setInterval","Date","now","current","clearInterval","lastActivityTimestamp","instanceState","followingUserId","highlightedUserIds","includes","currentPageId","brush","scribble","selectedIds","userName","cursor","color","chatMessage","isCursorInViewport","x","minX","y","minY","maxX","maxY","className","opacity","point","zoom","name","viewport","shapeId"],"sources":["/Users/lesleyshinhiwa/Downloads/tldraw-partykit-example-2/Co/node_modules/@tldraw/editor/src/lib/components/LiveCollaborators.tsx"],"sourcesContent":["import { useEffect, useRef, useState } from 'react'\nimport { track } from 'signia-react'\nimport { COLLABORATOR_CHECK_INTERVAL, COLLABORATOR_TIMEOUT } from '../constants'\nimport { useEditor } from '../hooks/useEditor'\nimport { useEditorComponents } from '../hooks/useEditorComponents'\nimport { usePeerIds } from '../hooks/usePeerIds'\nimport { usePresence } from '../hooks/usePresence'\n\nexport const LiveCollaborators = track(function Collaborators() {\n\tconst peerIds = usePeerIds()\n\treturn (\n\t\t<>\n\t\t\t{peerIds.map((id) => (\n\t\t\t\t<Collaborator key={id} userId={id} />\n\t\t\t))}\n\t\t</>\n\t)\n})\n\nconst Collaborator = track(function Collaborator({ userId }: { userId: string }) {\n\tconst editor = useEditor()\n\tconst { viewportPageBounds, zoomLevel } = editor\n\n\tconst {\n\t\tCollaboratorBrush,\n\t\tCollaboratorScribble,\n\t\tCollaboratorCursor,\n\t\tCollaboratorHint,\n\t\tCollaboratorShapeIndicator,\n\t} = useEditorComponents()\n\n\tconst latestPresence = usePresence(userId)\n\n\tconst [isTimedOut, setIsTimedOut] = useState(false)\n\tconst rLastSeen = useRef(-1)\n\n\tuseEffect(() => {\n\t\tconst interval = setInterval(() => {\n\t\t\tsetIsTimedOut(Date.now() - rLastSeen.current > COLLABORATOR_TIMEOUT)\n\t\t}, COLLABORATOR_CHECK_INTERVAL)\n\n\t\treturn () => clearInterval(interval)\n\t}, [])\n\n\tif (!latestPresence) return null\n\n\t// We can do this on every render, it's free and would be the same as running a useEffect with a dependency on the timestamp\n\trLastSeen.current = latestPresence.lastActivityTimestamp\n\n\t// If the user has timed out\n\t// ... and we're not following them\n\t// ... and they're not highlighted\n\t// then we'll hide the contributor\n\tif (\n\t\tisTimedOut &&\n\t\teditor.instanceState.followingUserId !== userId &&\n\t\t!editor.instanceState.highlightedUserIds.includes(userId)\n\t)\n\t\treturn null\n\n\t// if the collaborator is on another page, ignore them\n\tif (latestPresence.currentPageId !== editor.currentPageId) return null\n\n\tconst { brush, scribble, selectedIds, userName, cursor, color, chatMessage } = latestPresence\n\n\t// Add a little padding to the top-left of the viewport\n\t// so that the cursor doesn't get cut off\n\tconst isCursorInViewport = !(\n\t\tcursor.x < viewportPageBounds.minX - 12 / zoomLevel ||\n\t\tcursor.y < viewportPageBounds.minY - 16 / zoomLevel ||\n\t\tcursor.x > viewportPageBounds.maxX - 12 / zoomLevel ||\n\t\tcursor.y > viewportPageBounds.maxY - 16 / zoomLevel\n\t)\n\n\treturn (\n\t\t<>\n\t\t\t{brush && CollaboratorBrush ? (\n\t\t\t\t<CollaboratorBrush\n\t\t\t\t\tclassName=\"tl-collaborator__brush\"\n\t\t\t\t\tkey={userId + '_brush'}\n\t\t\t\t\tbrush={brush}\n\t\t\t\t\tcolor={color}\n\t\t\t\t\topacity={0.1}\n\t\t\t\t/>\n\t\t\t) : null}\n\t\t\t{isCursorInViewport && CollaboratorCursor ? (\n\t\t\t\t<CollaboratorCursor\n\t\t\t\t\tclassName=\"tl-collaborator__cursor\"\n\t\t\t\t\tkey={userId + '_cursor'}\n\t\t\t\t\tpoint={cursor}\n\t\t\t\t\tcolor={color}\n\t\t\t\t\tzoom={zoomLevel}\n\t\t\t\t\tname={userName !== 'New User' ? userName : null}\n\t\t\t\t\tchatMessage={chatMessage}\n\t\t\t\t/>\n\t\t\t) : CollaboratorHint ? (\n\t\t\t\t<CollaboratorHint\n\t\t\t\t\tclassName=\"tl-collaborator__cursor-hint\"\n\t\t\t\t\tkey={userId + '_cursor_hint'}\n\t\t\t\t\tpoint={cursor}\n\t\t\t\t\tcolor={color}\n\t\t\t\t\tzoom={zoomLevel}\n\t\t\t\t\tviewport={viewportPageBounds}\n\t\t\t\t/>\n\t\t\t) : null}\n\t\t\t{scribble && CollaboratorScribble ? (\n\t\t\t\t<CollaboratorScribble\n\t\t\t\t\tclassName=\"tl-collaborator__scribble\"\n\t\t\t\t\tkey={userId + '_scribble'}\n\t\t\t\t\tscribble={scribble}\n\t\t\t\t\tcolor={color}\n\t\t\t\t\tzoom={zoomLevel}\n\t\t\t\t\topacity={scribble.color === 'laser' ? 0.5 : 0.1}\n\t\t\t\t/>\n\t\t\t) : null}\n\t\t\t{CollaboratorShapeIndicator &&\n\t\t\t\tselectedIds.map((shapeId) => (\n\t\t\t\t\t<CollaboratorShapeIndicator\n\t\t\t\t\t\tclassName=\"tl-collaborator__shape-indicator\"\n\t\t\t\t\t\tkey={userId + '_' + shapeId}\n\t\t\t\t\t\tid={shapeId}\n\t\t\t\t\t\tcolor={color}\n\t\t\t\t\t\topacity={0.5}\n\t\t\t\t\t/>\n\t\t\t\t))}\n\t\t</>\n\t)\n})\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}