{"ast":null,"code":"import _regeneratorRuntime from \"/Users/lesleyshinhiwa/Downloads/tldraw-partykit-example-2/Co/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/lesleyshinhiwa/Downloads/tldraw-partykit-example-2/Co/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _slicedToArray from \"/Users/lesleyshinhiwa/Downloads/tldraw-partykit-example-2/Co/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _objectSpread from \"/Users/lesleyshinhiwa/Downloads/tldraw-partykit-example-2/Co/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport { Fragment, jsx, jsxs } from \"react/jsx-runtime\";\nimport { Matrix2d, toDomPrecision } from \"@tldraw/primitives\";\nimport { dedupe, modulate } from \"@tldraw/utils\";\nimport React from \"react\";\nimport { react } from \"signia\";\nimport { track, useValue } from \"signia-react\";\nimport { useCanvasEvents } from \"../hooks/useCanvasEvents.mjs\";\nimport { useCoarsePointer } from \"../hooks/useCoarsePointer.mjs\";\nimport { useDocumentEvents } from \"../hooks/useDocumentEvents.mjs\";\nimport { useEditor } from \"../hooks/useEditor.mjs\";\nimport { useEditorComponents } from \"../hooks/useEditorComponents.mjs\";\nimport { useFixSafariDoubleTapZoomPencilEvents } from \"../hooks/useFixSafariDoubleTapZoomPencilEvents.mjs\";\nimport { useGestureEvents } from \"../hooks/useGestureEvents.mjs\";\nimport { useHandleEvents } from \"../hooks/useHandleEvents.mjs\";\nimport { usePattern } from \"../hooks/usePattern.mjs\";\nimport { useQuickReactor } from \"../hooks/useQuickReactor.mjs\";\nimport { useScreenBounds } from \"../hooks/useScreenBounds.mjs\";\nimport { debugFlags } from \"../utils/debug-flags.mjs\";\nimport { LiveCollaborators } from \"./LiveCollaborators.mjs\";\nimport { SelectionBg } from \"./SelectionBg.mjs\";\nimport { SelectionFg } from \"./SelectionFg.mjs\";\nimport { Shape } from \"./Shape.mjs\";\nimport { ShapeIndicator } from \"./ShapeIndicator.mjs\";\nvar Canvas = track(function Canvas2() {\n  var editor = useEditor();\n  var _useEditorComponents = useEditorComponents(),\n    Background = _useEditorComponents.Background,\n    SvgDefs = _useEditorComponents.SvgDefs;\n  var rCanvas = React.useRef(null);\n  var rHtmlLayer = React.useRef(null);\n  useScreenBounds();\n  useDocumentEvents();\n  useCoarsePointer();\n  useGestureEvents(rCanvas);\n  useFixSafariDoubleTapZoomPencilEvents(rCanvas);\n  useQuickReactor(\"position layers\", function () {\n    var htmlElm = rHtmlLayer.current;\n    if (!htmlElm) return;\n    var _editor$camera = editor.camera,\n      x = _editor$camera.x,\n      y = _editor$camera.y,\n      z = _editor$camera.z;\n    var offset = z >= 1 ? modulate(z, [1, 8], [0.125, 0.5], true) : modulate(z, [0.1, 1], [-2, 0.125], true);\n    htmlElm.style.setProperty(\"transform\", \"scale(\".concat(toDomPrecision(z), \") translate(\").concat(toDomPrecision(x + offset), \"px,\").concat(toDomPrecision(y + offset), \"px)\"));\n  }, [editor]);\n  var _usePattern = usePattern(),\n    patternContext = _usePattern.context,\n    patternIsReady = _usePattern.isReady;\n  var events = useCanvasEvents();\n  React.useEffect(function () {\n    if (patternIsReady && editor.isSafari) {\n      var htmlElm = rHtmlLayer.current;\n      if (htmlElm) {\n        requestAnimationFrame(function () {\n          htmlElm.style.display = \"none\";\n          requestAnimationFrame(function () {\n            htmlElm.style.display = \"\";\n          });\n        });\n      }\n    }\n  }, [editor, patternIsReady]);\n  React.useEffect(function () {\n    var _rCanvas$current;\n    (_rCanvas$current = rCanvas.current) === null || _rCanvas$current === void 0 || _rCanvas$current.focus();\n  }, []);\n  return /* @__PURE__ */jsxs(\"div\", _objectSpread(_objectSpread({\n    ref: rCanvas,\n    draggable: false,\n    className: \"tl-canvas\",\n    \"data-testid\": \"canvas\"\n  }, events), {}, {\n    children: [Background && /* @__PURE__ */jsx(Background, {}), /* @__PURE__ */jsx(GridWrapper, {}), /* @__PURE__ */jsx(UiLogger, {}), /* @__PURE__ */jsxs(\"div\", {\n      ref: rHtmlLayer,\n      className: \"tl-html-layer\",\n      draggable: false,\n      children: [/* @__PURE__ */jsx(\"svg\", {\n        className: \"tl-svg-context\",\n        children: /* @__PURE__ */jsxs(\"defs\", {\n          children: [patternContext, Cursor && /* @__PURE__ */jsx(Cursor, {}), /* @__PURE__ */jsx(CollaboratorHint, {}), /* @__PURE__ */jsx(ArrowheadDot, {}), /* @__PURE__ */jsx(ArrowheadCross, {}), SvgDefs && /* @__PURE__ */jsx(SvgDefs, {})]\n        })\n      }), /* @__PURE__ */jsx(SelectionBg, {}), /* @__PURE__ */jsx(\"div\", {\n        className: \"tl-shapes\",\n        children: /* @__PURE__ */jsx(ShapesToDisplay, {})\n      }), /* @__PURE__ */jsxs(\"div\", {\n        className: \"tl-overlays\",\n        children: [/* @__PURE__ */jsx(HandlesWrapper, {}), /* @__PURE__ */jsx(BrushWrapper, {}), /* @__PURE__ */jsx(ScribbleWrapper, {}), /* @__PURE__ */jsx(ZoomBrushWrapper, {}), /* @__PURE__ */jsx(SelectedIdIndicators, {}), /* @__PURE__ */jsx(HoveredShapeIndicator, {}), /* @__PURE__ */jsx(HintedShapeIndicator, {}), /* @__PURE__ */jsx(SnapLinesWrapper, {}), /* @__PURE__ */jsx(SelectionFg, {}), /* @__PURE__ */jsx(LiveCollaborators, {})]\n      })]\n    })]\n  }));\n});\nvar GridWrapper = track(function GridWrapper2() {\n  var editor = useEditor();\n  var _useEditorComponents2 = useEditorComponents(),\n    Grid = _useEditorComponents2.Grid;\n  var _editor$camera2 = editor.camera,\n    x = _editor$camera2.x,\n    y = _editor$camera2.y,\n    z = _editor$camera2.z;\n  var isGridMode = editor.isGridMode;\n  if (!(Grid && isGridMode)) return null;\n  return /* @__PURE__ */jsx(Grid, {\n    x: x,\n    y: y,\n    z: z,\n    size: editor.gridSize\n  });\n});\nvar ScribbleWrapper = track(function ScribbleWrapper2() {\n  var editor = useEditor();\n  var scribble = editor.scribble;\n  var zoom = editor.zoomLevel;\n  var _useEditorComponents3 = useEditorComponents(),\n    Scribble = _useEditorComponents3.Scribble;\n  if (!(Scribble && scribble)) return null;\n  return /* @__PURE__ */jsx(Scribble, {\n    className: \"tl-user-scribble\",\n    scribble: scribble,\n    zoom: zoom\n  });\n});\nvar BrushWrapper = track(function BrushWrapper2() {\n  var editor = useEditor();\n  var brush = editor.brush;\n  var _useEditorComponents4 = useEditorComponents(),\n    Brush = _useEditorComponents4.Brush;\n  if (!(Brush && brush && editor.isIn(\"select.brushing\"))) return null;\n  return /* @__PURE__ */jsx(Brush, {\n    className: \"tl-user-brush\",\n    brush: brush\n  });\n});\nvar ZoomBrushWrapper = track(function Zoom() {\n  var editor = useEditor();\n  var zoomBrush = editor.zoomBrush;\n  var _useEditorComponents5 = useEditorComponents(),\n    ZoomBrush = _useEditorComponents5.ZoomBrush;\n  if (!(ZoomBrush && zoomBrush && editor.isIn(\"zoom\"))) return null;\n  return /* @__PURE__ */jsx(ZoomBrush, {\n    className: \"tl-user-brush\",\n    brush: zoomBrush\n  });\n});\nvar SnapLinesWrapper = track(function SnapLines() {\n  var editor = useEditor();\n  var lines = editor.snaps.lines,\n    zoomLevel = editor.zoomLevel;\n  var _useEditorComponents6 = useEditorComponents(),\n    SnapLine = _useEditorComponents6.SnapLine;\n  if (!(SnapLine && lines.length > 0)) return null;\n  return /* @__PURE__ */jsx(Fragment, {\n    children: lines.map(function (line) {\n      return /* @__PURE__ */jsx(SnapLine, {\n        className: \"tl-user-snapline\",\n        line: line,\n        zoom: zoomLevel\n      }, line.id);\n    })\n  });\n});\nvar MIN_HANDLE_DISTANCE = 48;\nvar HandlesWrapper = track(function HandlesWrapper2() {\n  var _util$handles;\n  var editor = useEditor();\n  var zoom = editor.zoomLevel;\n  var isChangingStyle = editor.isChangingStyle;\n  var onlySelectedShape = editor.onlySelectedShape;\n  var shouldDisplayHandles = editor.isInAny(\"select.idle\", \"select.pointing_handle\") && !isChangingStyle && !editor.isReadOnly;\n  if (!(onlySelectedShape && shouldDisplayHandles)) return null;\n  var util = editor.getShapeUtil(onlySelectedShape);\n  var handles = (_util$handles = util.handles) === null || _util$handles === void 0 ? void 0 : _util$handles.call(util, onlySelectedShape);\n  if (!handles) return null;\n  var transform = editor.getPageTransform(onlySelectedShape);\n  if (!transform) return null;\n  var handlesToDisplay = [];\n  for (var i = 0, handle = handles[i]; i < handles.length; i++, handle = handles[i]) {\n    if (handle.type !== \"vertex\") {\n      var prev = handles[i - 1];\n      var next = handles[i + 1];\n      if (prev && next) {\n        if (Math.hypot(prev.y - next.y, prev.x - next.x) < MIN_HANDLE_DISTANCE / zoom) {\n          continue;\n        }\n      }\n    }\n    handlesToDisplay.push(handle);\n  }\n  handlesToDisplay.sort(function (a) {\n    return a.type === \"vertex\" ? 1 : -1;\n  });\n  return /* @__PURE__ */jsx(\"svg\", {\n    className: \"tl-user-handles tl-overlays__item\",\n    children: /* @__PURE__ */jsx(\"g\", {\n      transform: Matrix2d.toCssString(transform),\n      children: handlesToDisplay.map(function (handle) {\n        return /* @__PURE__ */jsx(HandleWrapper, {\n          shapeId: onlySelectedShape.id,\n          handle: handle\n        }, handle.id);\n      })\n    })\n  });\n});\nvar HandleWrapper = function HandleWrapper(_ref) {\n  var shapeId = _ref.shapeId,\n    handle = _ref.handle;\n  var events = useHandleEvents(shapeId, handle.id);\n  var _useEditorComponents7 = useEditorComponents(),\n    Handle = _useEditorComponents7.Handle;\n  if (!Handle) return null;\n  return /* @__PURE__ */jsx(\"g\", _objectSpread(_objectSpread({\n    \"aria-label\": \"handle\",\n    transform: \"translate(\".concat(handle.x, \", \").concat(handle.y, \")\")\n  }, events), {}, {\n    children: /* @__PURE__ */jsx(Handle, {\n      shapeId: shapeId,\n      handle: handle\n    })\n  }));\n};\nvar ShapesToDisplay = track(function ShapesToDisplay2() {\n  var editor = useEditor();\n  var renderingShapes = editor.renderingShapes;\n  var debugSvg = debugFlags.debugSvg.value;\n  if (debugSvg) {\n    return /* @__PURE__ */jsx(Fragment, {\n      children: renderingShapes.map(function (result) {\n        return /* @__PURE__ */jsxs(React.Fragment, {\n          children: [/* @__PURE__ */jsx(Shape, _objectSpread({}, result)), /* @__PURE__ */jsx(DebugSvgCopy, {\n            id: result.id\n          })]\n        }, result.id + \"_fragment\");\n      })\n    });\n  }\n  return /* @__PURE__ */jsx(Fragment, {\n    children: renderingShapes.map(function (result) {\n      return /* @__PURE__ */jsx(Shape, _objectSpread({}, result), result.id + \"_shape\");\n    })\n  });\n});\nvar SelectedIdIndicators = track(function SelectedIdIndicators2() {\n  var editor = useEditor();\n  var shouldDisplay = editor.isInAny(\"select.idle\", \"select.brushing\", \"select.scribble_brushing\", \"select.pointing_shape\", \"select.pointing_selection\", \"select.pointing_handle\") && !editor.isChangingStyle;\n  if (!shouldDisplay) return null;\n  return /* @__PURE__ */jsx(Fragment, {\n    children: editor.selectedIds.map(function (id) {\n      return /* @__PURE__ */jsx(ShapeIndicator, {\n        className: \"tl-user-indicator__selected\",\n        id: id\n      }, id + \"_indicator\");\n    })\n  });\n});\nvar HoveredShapeIndicator = function HoveredShapeIndicator2() {\n  var editor = useEditor();\n  var displayingHoveredId = useValue(\"hovered id and should display\", function () {\n    return editor.isInAny(\"select.idle\", \"select.editing_shape\") ? editor.pageState.hoveredId : null;\n  }, [editor]);\n  if (!displayingHoveredId) return null;\n  return /* @__PURE__ */jsx(ShapeIndicator, {\n    className: \"tl-user-indicator__hovered\",\n    id: displayingHoveredId\n  });\n};\nvar HintedShapeIndicator = track(function HintedShapeIndicator2() {\n  var editor = useEditor();\n  var ids = dedupe(editor.hintingIds);\n  if (!ids.length) return null;\n  return /* @__PURE__ */jsx(Fragment, {\n    children: ids.map(function (id) {\n      return /* @__PURE__ */jsx(ShapeIndicator, {\n        className: \"tl-user-indicator__hint\",\n        id: id\n      }, id + \"_hinting\");\n    })\n  });\n});\nfunction Cursor() {\n  return /* @__PURE__ */jsxs(\"g\", {\n    id: \"cursor\",\n    children: [/* @__PURE__ */jsxs(\"g\", {\n      fill: \"rgba(0,0,0,.2)\",\n      transform: \"translate(-11,-11)\",\n      children: [/* @__PURE__ */jsx(\"path\", {\n        d: \"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z\"\n      }), /* @__PURE__ */jsx(\"path\", {\n        d: \"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z\"\n      })]\n    }), /* @__PURE__ */jsxs(\"g\", {\n      fill: \"white\",\n      transform: \"translate(-12,-12)\",\n      children: [/* @__PURE__ */jsx(\"path\", {\n        d: \"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z\"\n      }), /* @__PURE__ */jsx(\"path\", {\n        d: \"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z\"\n      })]\n    }), /* @__PURE__ */jsxs(\"g\", {\n      fill: \"currentColor\",\n      transform: \"translate(-12,-12)\",\n      children: [/* @__PURE__ */jsx(\"path\", {\n        d: \"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z\"\n      }), /* @__PURE__ */jsx(\"path\", {\n        d: \"m13 10.814v11.188l2.969-2.866.428-.139h4.768z\"\n      })]\n    })]\n  });\n}\nfunction CollaboratorHint() {\n  return /* @__PURE__ */jsx(\"path\", {\n    id: \"cursor_hint\",\n    fill: \"currentColor\",\n    d: \"M -2,-5 2,0 -2,5 Z\"\n  });\n}\nfunction ArrowheadDot() {\n  return /* @__PURE__ */jsx(\"marker\", {\n    id: \"arrowhead-dot\",\n    className: \"tl-arrow-hint\",\n    refX: \"3.0\",\n    refY: \"3.0\",\n    orient: \"0\",\n    children: /* @__PURE__ */jsx(\"circle\", {\n      cx: \"3\",\n      cy: \"3\",\n      r: \"2\",\n      strokeDasharray: \"100%\"\n    })\n  });\n}\nfunction ArrowheadCross() {\n  return /* @__PURE__ */jsxs(\"marker\", {\n    id: \"arrowhead-cross\",\n    className: \"tl-arrow-hint\",\n    refX: \"3.0\",\n    refY: \"3.0\",\n    orient: \"auto\",\n    children: [/* @__PURE__ */jsx(\"line\", {\n      x1: \"1.5\",\n      y1: \"1.5\",\n      x2: \"4.5\",\n      y2: \"4.5\",\n      strokeDasharray: \"100%\"\n    }), /* @__PURE__ */jsx(\"line\", {\n      x1: \"1.5\",\n      y1: \"4.5\",\n      x2: \"4.5\",\n      y2: \"1.5\",\n      strokeDasharray: \"100%\"\n    })]\n  });\n}\nvar DebugSvgCopy = track(function DupSvg(_ref2) {\n  var id = _ref2.id;\n  var editor = useEditor();\n  var shape = editor.getShapeById(id);\n  var _React$useState = React.useState(\"\"),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    html = _React$useState2[0],\n    setHtml = _React$useState2[1];\n  var isInRoot = (shape === null || shape === void 0 ? void 0 : shape.parentId) === editor.currentPageId;\n  React.useEffect(function () {\n    if (!isInRoot) return;\n    var latest = null;\n    var unsubscribe = react(\"shape to svg\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      var renderId, bb, el;\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            renderId = Math.random();\n            latest = renderId;\n            bb = editor.getPageBoundsById(id);\n            _context.next = 5;\n            return editor.getSvg([id], {\n              padding: 0\n            });\n          case 5:\n            el = _context.sent;\n            if (el && bb && latest === renderId) {\n              el.style.setProperty(\"overflow\", \"visible\");\n              el.setAttribute(\"preserveAspectRatio\", \"xMidYMin slice\");\n              el.style.setProperty(\"transform\", \"translate(\".concat(bb.x, \"px, \").concat(bb.y + bb.h + 12, \"px)\"));\n              el.style.setProperty(\"border\", \"1px solid black\");\n              setHtml(el === null || el === void 0 ? void 0 : el.outerHTML);\n            }\n          case 7:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee);\n    })));\n    return function () {\n      latest = null;\n      unsubscribe();\n    };\n  }, [editor, id, isInRoot]);\n  if (!isInRoot) return null;\n  return /* @__PURE__ */jsx(\"div\", {\n    style: {\n      paddingTop: 12,\n      position: \"absolute\"\n    },\n    children: /* @__PURE__ */jsx(\"div\", {\n      style: {\n        display: \"flex\"\n      },\n      dangerouslySetInnerHTML: {\n        __html: html\n      }\n    })\n  });\n});\nvar UiLogger = track(function () {\n  var logMessages = debugFlags.logMessages.value;\n  return /* @__PURE__ */jsx(\"div\", {\n    className: \"debug__ui-logger\",\n    children: logMessages.map(function (message, messageIndex) {\n      var text = typeof message === \"string\" ? message : JSON.stringify(message);\n      return /* @__PURE__ */jsx(\"div\", {\n        className: \"debug__ui-logger__line\",\n        children: text\n      }, messageIndex);\n    })\n  });\n});\nexport { Canvas, SnapLinesWrapper, ZoomBrushWrapper };","map":{"version":3,"names":["Fragment","jsx","jsxs","Matrix2d","toDomPrecision","dedupe","modulate","React","react","track","useValue","useCanvasEvents","useCoarsePointer","useDocumentEvents","useEditor","useEditorComponents","useFixSafariDoubleTapZoomPencilEvents","useGestureEvents","useHandleEvents","usePattern","useQuickReactor","useScreenBounds","debugFlags","LiveCollaborators","SelectionBg","SelectionFg","Shape","ShapeIndicator","Canvas","Canvas2","editor","_useEditorComponents","Background","SvgDefs","rCanvas","useRef","rHtmlLayer","htmlElm","current","_editor$camera","camera","x","y","z","offset","style","setProperty","concat","_usePattern","patternContext","context","patternIsReady","isReady","events","useEffect","isSafari","requestAnimationFrame","display","_rCanvas$current","focus","_objectSpread","ref","draggable","className","children","GridWrapper","UiLogger","Cursor","CollaboratorHint","ArrowheadDot","ArrowheadCross","ShapesToDisplay","HandlesWrapper","BrushWrapper","ScribbleWrapper","ZoomBrushWrapper","SelectedIdIndicators","HoveredShapeIndicator","HintedShapeIndicator","SnapLinesWrapper","GridWrapper2","_useEditorComponents2","Grid","_editor$camera2","isGridMode","size","gridSize","ScribbleWrapper2","scribble","zoom","zoomLevel","_useEditorComponents3","Scribble","BrushWrapper2","brush","_useEditorComponents4","Brush","isIn","Zoom","zoomBrush","_useEditorComponents5","ZoomBrush","SnapLines","lines","snaps","_useEditorComponents6","SnapLine","length","map","line","id","MIN_HANDLE_DISTANCE","HandlesWrapper2","_util$handles","isChangingStyle","onlySelectedShape","shouldDisplayHandles","isInAny","isReadOnly","util","getShapeUtil","handles","call","transform","getPageTransform","handlesToDisplay","i","handle","type","prev","next","Math","hypot","push","sort","a","toCssString","HandleWrapper","shapeId","_ref","_useEditorComponents7","Handle","ShapesToDisplay2","renderingShapes","debugSvg","value","result","DebugSvgCopy","SelectedIdIndicators2","shouldDisplay","selectedIds","HoveredShapeIndicator2","displayingHoveredId","pageState","hoveredId","HintedShapeIndicator2","ids","hintingIds","fill","d","refX","refY","orient","cx","cy","r","strokeDasharray","x1","y1","x2","y2","DupSvg","_ref2","shape","getShapeById","_React$useState","useState","_React$useState2","_slicedToArray","html","setHtml","isInRoot","parentId","currentPageId","latest","unsubscribe","_asyncToGenerator","_regeneratorRuntime","mark","_callee","renderId","bb","el","wrap","_callee$","_context","random","getPageBoundsById","getSvg","padding","sent","setAttribute","h","outerHTML","stop","paddingTop","position","dangerouslySetInnerHTML","__html","logMessages","message","messageIndex","text","JSON","stringify"],"sources":["/Users/lesleyshinhiwa/Downloads/tldraw-partykit-example-2/Co/node_modules/@tldraw/editor/src/lib/components/Canvas.tsx"],"sourcesContent":["import { Matrix2d, toDomPrecision } from '@tldraw/primitives'\nimport { TLHandle, TLShapeId } from '@tldraw/tlschema'\nimport { dedupe, modulate } from '@tldraw/utils'\nimport React from 'react'\nimport { react } from 'signia'\nimport { track, useValue } from 'signia-react'\nimport { useCanvasEvents } from '../hooks/useCanvasEvents'\nimport { useCoarsePointer } from '../hooks/useCoarsePointer'\nimport { useDocumentEvents } from '../hooks/useDocumentEvents'\nimport { useEditor } from '../hooks/useEditor'\nimport { useEditorComponents } from '../hooks/useEditorComponents'\nimport { useFixSafariDoubleTapZoomPencilEvents } from '../hooks/useFixSafariDoubleTapZoomPencilEvents'\nimport { useGestureEvents } from '../hooks/useGestureEvents'\nimport { useHandleEvents } from '../hooks/useHandleEvents'\nimport { usePattern } from '../hooks/usePattern'\nimport { useQuickReactor } from '../hooks/useQuickReactor'\nimport { useScreenBounds } from '../hooks/useScreenBounds'\nimport { debugFlags } from '../utils/debug-flags'\nimport { LiveCollaborators } from './LiveCollaborators'\nimport { SelectionBg } from './SelectionBg'\nimport { SelectionFg } from './SelectionFg'\nimport { Shape } from './Shape'\nimport { ShapeIndicator } from './ShapeIndicator'\n\n/** @public */\nexport const Canvas = track(function Canvas() {\n\tconst editor = useEditor()\n\n\tconst { Background, SvgDefs } = useEditorComponents()\n\n\tconst rCanvas = React.useRef<HTMLDivElement>(null)\n\tconst rHtmlLayer = React.useRef<HTMLDivElement>(null)\n\n\tuseScreenBounds()\n\tuseDocumentEvents()\n\tuseCoarsePointer()\n\n\tuseGestureEvents(rCanvas)\n\tuseFixSafariDoubleTapZoomPencilEvents(rCanvas)\n\n\tuseQuickReactor(\n\t\t'position layers',\n\t\t() => {\n\t\t\tconst htmlElm = rHtmlLayer.current\n\t\t\tif (!htmlElm) return\n\n\t\t\tconst { x, y, z } = editor.camera\n\n\t\t\t// Because the html container has a width/height of 1px, we\n\t\t\t// need to create a small offset when zoomed to ensure that\n\t\t\t// the html container and svg container are lined up exactly.\n\t\t\tconst offset =\n\t\t\t\tz >= 1 ? modulate(z, [1, 8], [0.125, 0.5], true) : modulate(z, [0.1, 1], [-2, 0.125], true)\n\n\t\t\thtmlElm.style.setProperty(\n\t\t\t\t'transform',\n\t\t\t\t`scale(${toDomPrecision(z)}) translate(${toDomPrecision(x + offset)}px,${toDomPrecision(\n\t\t\t\t\ty + offset\n\t\t\t\t)}px)`\n\t\t\t)\n\t\t},\n\t\t[editor]\n\t)\n\n\tconst { context: patternContext, isReady: patternIsReady } = usePattern()\n\n\tconst events = useCanvasEvents()\n\n\tReact.useEffect(() => {\n\t\tif (patternIsReady && editor.isSafari) {\n\t\t\tconst htmlElm = rHtmlLayer.current\n\n\t\t\tif (htmlElm) {\n\t\t\t\t// Wait for `patternContext` to be picked up\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\thtmlElm.style.display = 'none'\n\n\t\t\t\t\t// Wait for 'display = \"none\"' to take effect\n\t\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\t\thtmlElm.style.display = ''\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}, [editor, patternIsReady])\n\n\tReact.useEffect(() => {\n\t\trCanvas.current?.focus()\n\t}, [])\n\n\treturn (\n\t\t<div ref={rCanvas} draggable={false} className=\"tl-canvas\" data-testid=\"canvas\" {...events}>\n\t\t\t{Background && <Background />}\n\t\t\t<GridWrapper />\n\t\t\t<UiLogger />\n\t\t\t<div ref={rHtmlLayer} className=\"tl-html-layer\" draggable={false}>\n\t\t\t\t<svg className=\"tl-svg-context\">\n\t\t\t\t\t<defs>\n\t\t\t\t\t\t{patternContext}\n\t\t\t\t\t\t{Cursor && <Cursor />}\n\t\t\t\t\t\t<CollaboratorHint />\n\t\t\t\t\t\t<ArrowheadDot />\n\t\t\t\t\t\t<ArrowheadCross />\n\t\t\t\t\t\t{SvgDefs && <SvgDefs />}\n\t\t\t\t\t</defs>\n\t\t\t\t</svg>\n\t\t\t\t<SelectionBg />\n\t\t\t\t<div className=\"tl-shapes\">\n\t\t\t\t\t<ShapesToDisplay />\n\t\t\t\t</div>\n\t\t\t\t<div className=\"tl-overlays\">\n\t\t\t\t\t<HandlesWrapper />\n\t\t\t\t\t<BrushWrapper />\n\t\t\t\t\t<ScribbleWrapper />\n\t\t\t\t\t<ZoomBrushWrapper />\n\t\t\t\t\t<SelectedIdIndicators />\n\t\t\t\t\t<HoveredShapeIndicator />\n\t\t\t\t\t<HintedShapeIndicator />\n\t\t\t\t\t<SnapLinesWrapper />\n\t\t\t\t\t<SelectionFg />\n\t\t\t\t\t<LiveCollaborators />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t)\n})\n\nconst GridWrapper = track(function GridWrapper() {\n\tconst editor = useEditor()\n\tconst { Grid } = useEditorComponents()\n\n\t// get grid from context\n\n\tconst { x, y, z } = editor.camera\n\tconst isGridMode = editor.isGridMode\n\n\tif (!(Grid && isGridMode)) return null\n\n\treturn <Grid x={x} y={y} z={z} size={editor.gridSize} />\n})\n\nconst ScribbleWrapper = track(function ScribbleWrapper() {\n\tconst editor = useEditor()\n\tconst scribble = editor.scribble\n\tconst zoom = editor.zoomLevel\n\n\tconst { Scribble } = useEditorComponents()\n\n\tif (!(Scribble && scribble)) return null\n\n\treturn <Scribble className=\"tl-user-scribble\" scribble={scribble} zoom={zoom} />\n})\n\nconst BrushWrapper = track(function BrushWrapper() {\n\tconst editor = useEditor()\n\tconst { brush } = editor\n\tconst { Brush } = useEditorComponents()\n\n\tif (!(Brush && brush && editor.isIn('select.brushing'))) return null\n\n\treturn <Brush className=\"tl-user-brush\" brush={brush} />\n})\n\nexport const ZoomBrushWrapper = track(function Zoom() {\n\tconst editor = useEditor()\n\tconst { zoomBrush } = editor\n\tconst { ZoomBrush } = useEditorComponents()\n\n\tif (!(ZoomBrush && zoomBrush && editor.isIn('zoom'))) return null\n\n\treturn <ZoomBrush className=\"tl-user-brush\" brush={zoomBrush} />\n})\n\nexport const SnapLinesWrapper = track(function SnapLines() {\n\tconst editor = useEditor()\n\tconst {\n\t\tsnaps: { lines },\n\t\tzoomLevel,\n\t} = editor\n\tconst { SnapLine } = useEditorComponents()\n\n\tif (!(SnapLine && lines.length > 0)) return null\n\n\treturn (\n\t\t<>\n\t\t\t{lines.map((line) => (\n\t\t\t\t<SnapLine key={line.id} className=\"tl-user-snapline\" line={line} zoom={zoomLevel} />\n\t\t\t))}\n\t\t</>\n\t)\n})\n\nconst MIN_HANDLE_DISTANCE = 48\n\nconst HandlesWrapper = track(function HandlesWrapper() {\n\tconst editor = useEditor()\n\n\tconst zoom = editor.zoomLevel\n\tconst isChangingStyle = editor.isChangingStyle\n\n\tconst onlySelectedShape = editor.onlySelectedShape\n\n\tconst shouldDisplayHandles =\n\t\teditor.isInAny('select.idle', 'select.pointing_handle') &&\n\t\t!isChangingStyle &&\n\t\t!editor.isReadOnly\n\n\tif (!(onlySelectedShape && shouldDisplayHandles)) return null\n\n\tconst util = editor.getShapeUtil(onlySelectedShape)\n\tconst handles = util.handles?.(onlySelectedShape)\n\n\tif (!handles) return null\n\n\tconst transform = editor.getPageTransform(onlySelectedShape)\n\n\tif (!transform) return null\n\n\t// Don't display a temporary handle if the distance between it and its neighbors is too small.\n\tconst handlesToDisplay: TLHandle[] = []\n\n\tfor (let i = 0, handle = handles[i]; i < handles.length; i++, handle = handles[i]) {\n\t\tif (handle.type !== 'vertex') {\n\t\t\tconst prev = handles[i - 1]\n\t\t\tconst next = handles[i + 1]\n\t\t\tif (prev && next) {\n\t\t\t\tif (Math.hypot(prev.y - next.y, prev.x - next.x) < MIN_HANDLE_DISTANCE / zoom) {\n\t\t\t\t\tcontinue\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\thandlesToDisplay.push(handle)\n\t}\n\n\thandlesToDisplay.sort((a) => (a.type === 'vertex' ? 1 : -1))\n\n\treturn (\n\t\t<svg className=\"tl-user-handles tl-overlays__item\">\n\t\t\t<g transform={Matrix2d.toCssString(transform)}>\n\t\t\t\t{handlesToDisplay.map((handle) => {\n\t\t\t\t\treturn <HandleWrapper key={handle.id} shapeId={onlySelectedShape.id} handle={handle} />\n\t\t\t\t})}\n\t\t\t</g>\n\t\t</svg>\n\t)\n})\n\nconst HandleWrapper = ({ shapeId, handle }: { shapeId: TLShapeId; handle: TLHandle }) => {\n\tconst events = useHandleEvents(shapeId, handle.id)\n\tconst { Handle } = useEditorComponents()\n\n\tif (!Handle) return null\n\n\treturn (\n\t\t<g aria-label=\"handle\" transform={`translate(${handle.x}, ${handle.y})`} {...events}>\n\t\t\t<Handle shapeId={shapeId} handle={handle} />\n\t\t</g>\n\t)\n}\n\nconst ShapesToDisplay = track(function ShapesToDisplay() {\n\tconst editor = useEditor()\n\n\tconst { renderingShapes } = editor\n\n\tconst debugSvg = debugFlags.debugSvg.value\n\tif (debugSvg) {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t{renderingShapes.map((result) => (\n\t\t\t\t\t<React.Fragment key={result.id + '_fragment'}>\n\t\t\t\t\t\t<Shape {...result} />\n\t\t\t\t\t\t<DebugSvgCopy id={result.id} />\n\t\t\t\t\t</React.Fragment>\n\t\t\t\t))}\n\t\t\t</>\n\t\t)\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t{renderingShapes.map((result) => (\n\t\t\t\t<Shape key={result.id + '_shape'} {...result} />\n\t\t\t))}\n\t\t</>\n\t)\n})\n\nconst SelectedIdIndicators = track(function SelectedIdIndicators() {\n\tconst editor = useEditor()\n\n\tconst shouldDisplay =\n\t\teditor.isInAny(\n\t\t\t'select.idle',\n\t\t\t'select.brushing',\n\t\t\t'select.scribble_brushing',\n\t\t\t'select.pointing_shape',\n\t\t\t'select.pointing_selection',\n\t\t\t'select.pointing_handle'\n\t\t) && !editor.isChangingStyle\n\n\tif (!shouldDisplay) return null\n\n\treturn (\n\t\t<>\n\t\t\t{editor.selectedIds.map((id) => (\n\t\t\t\t<ShapeIndicator key={id + '_indicator'} className=\"tl-user-indicator__selected\" id={id} />\n\t\t\t))}\n\t\t</>\n\t)\n})\n\nconst HoveredShapeIndicator = function HoveredShapeIndicator() {\n\tconst editor = useEditor()\n\n\tconst displayingHoveredId = useValue(\n\t\t'hovered id and should display',\n\t\t() =>\n\t\t\teditor.isInAny('select.idle', 'select.editing_shape') ? editor.pageState.hoveredId : null,\n\t\t[editor]\n\t)\n\n\tif (!displayingHoveredId) return null\n\n\treturn <ShapeIndicator className=\"tl-user-indicator__hovered\" id={displayingHoveredId} />\n}\n\nconst HintedShapeIndicator = track(function HintedShapeIndicator() {\n\tconst editor = useEditor()\n\n\tconst ids = dedupe(editor.hintingIds)\n\n\tif (!ids.length) return null\n\n\treturn (\n\t\t<>\n\t\t\t{ids.map((id) => (\n\t\t\t\t<ShapeIndicator className=\"tl-user-indicator__hint\" id={id} key={id + '_hinting'} />\n\t\t\t))}\n\t\t</>\n\t)\n})\n\nfunction Cursor() {\n\treturn (\n\t\t<g id=\"cursor\">\n\t\t\t<g fill=\"rgba(0,0,0,.2)\" transform=\"translate(-11,-11)\">\n\t\t\t\t<path d=\"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z\" />\n\t\t\t\t<path d=\"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z\" />\n\t\t\t</g>\n\t\t\t<g fill=\"white\" transform=\"translate(-12,-12)\">\n\t\t\t\t<path d=\"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z\" />\n\t\t\t\t<path d=\"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z\" />\n\t\t\t</g>\n\t\t\t<g fill=\"currentColor\" transform=\"translate(-12,-12)\">\n\t\t\t\t<path d=\"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z\" />\n\t\t\t\t<path d=\"m13 10.814v11.188l2.969-2.866.428-.139h4.768z\" />\n\t\t\t</g>\n\t\t</g>\n\t)\n}\n\nfunction CollaboratorHint() {\n\treturn <path id=\"cursor_hint\" fill=\"currentColor\" d=\"M -2,-5 2,0 -2,5 Z\" />\n}\n\nfunction ArrowheadDot() {\n\treturn (\n\t\t<marker id=\"arrowhead-dot\" className=\"tl-arrow-hint\" refX=\"3.0\" refY=\"3.0\" orient=\"0\">\n\t\t\t<circle cx=\"3\" cy=\"3\" r=\"2\" strokeDasharray=\"100%\" />\n\t\t</marker>\n\t)\n}\n\nfunction ArrowheadCross() {\n\treturn (\n\t\t<marker id=\"arrowhead-cross\" className=\"tl-arrow-hint\" refX=\"3.0\" refY=\"3.0\" orient=\"auto\">\n\t\t\t<line x1=\"1.5\" y1=\"1.5\" x2=\"4.5\" y2=\"4.5\" strokeDasharray=\"100%\" />\n\t\t\t<line x1=\"1.5\" y1=\"4.5\" x2=\"4.5\" y2=\"1.5\" strokeDasharray=\"100%\" />\n\t\t</marker>\n\t)\n}\n\nconst DebugSvgCopy = track(function DupSvg({ id }: { id: TLShapeId }) {\n\tconst editor = useEditor()\n\tconst shape = editor.getShapeById(id)\n\n\tconst [html, setHtml] = React.useState('')\n\n\tconst isInRoot = shape?.parentId === editor.currentPageId\n\n\tReact.useEffect(() => {\n\t\tif (!isInRoot) return\n\n\t\tlet latest = null\n\t\tconst unsubscribe = react('shape to svg', async () => {\n\t\t\tconst renderId = Math.random()\n\t\t\tlatest = renderId\n\t\t\tconst bb = editor.getPageBoundsById(id)\n\t\t\tconst el = await editor.getSvg([id], { padding: 0 })\n\t\t\tif (el && bb && latest === renderId) {\n\t\t\t\tel.style.setProperty('overflow', 'visible')\n\t\t\t\tel.setAttribute('preserveAspectRatio', 'xMidYMin slice')\n\t\t\t\tel.style.setProperty('transform', `translate(${bb.x}px, ${bb.y + bb.h + 12}px)`)\n\t\t\t\tel.style.setProperty('border', '1px solid black')\n\t\t\t\tsetHtml(el?.outerHTML)\n\t\t\t}\n\t\t})\n\n\t\treturn () => {\n\t\t\tlatest = null\n\t\t\tunsubscribe()\n\t\t}\n\t}, [editor, id, isInRoot])\n\n\tif (!isInRoot) return null\n\n\treturn (\n\t\t<div style={{ paddingTop: 12, position: 'absolute' }}>\n\t\t\t<div style={{ display: 'flex' }} dangerouslySetInnerHTML={{ __html: html }} />\n\t\t</div>\n\t)\n})\n\nconst UiLogger = track(() => {\n\tconst logMessages = debugFlags.logMessages.value\n\n\treturn (\n\t\t<div className=\"debug__ui-logger\">\n\t\t\t{logMessages.map((message, messageIndex) => {\n\t\t\t\tconst text = typeof message === 'string' ? message : JSON.stringify(message)\n\n\t\t\t\treturn (\n\t\t\t\t\t<div className=\"debug__ui-logger__line\" key={messageIndex}>\n\t\t\t\t\t\t{text}\n\t\t\t\t\t</div>\n\t\t\t\t)\n\t\t\t})}\n\t\t</div>\n\t)\n})\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}