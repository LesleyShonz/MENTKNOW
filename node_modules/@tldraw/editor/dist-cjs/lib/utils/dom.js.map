{
  "version": 3,
  "sources": ["../../../src/lib/utils/dom.ts"],
  "sourcesContent": ["/*\nThis is used to facilitate double clicking and pointer capture on elements.\n\nThe events in this file are possibly set on individual SVG elements, \nsuch as handles or corner handles, rather than on HTML elements or \nSVGSVGElements. Raw SVG elemnets do not support pointerCapture in \nmost cases, meaning that in order for pointer capture to work, we \nneed to crawl up the DOM tree to find the nearest HTML element. Then,\nin order for that element to also call the `onPointerUp` event from\nthis file, we need to manually set that event on that element and\nlater remove it when the pointerup occurs. This is a potential leak\nif the user clicks on a handle but the pointerup does not fire for\nwhatever reason.\n*/\n\nimport { Vec2d } from '@tldraw/primitives'\nimport React, { useEffect, useState } from 'react'\nimport { debugFlags } from './debug-flags'\n\n/** @public */\nexport function loopToHtmlElement(elm: Element): HTMLElement {\n\tif (elm instanceof HTMLElement) return elm\n\tif (elm.parentElement) return loopToHtmlElement(elm.parentElement)\n\telse throw Error('Could not find a parent element of an HTML type!')\n}\n\n/**\n * This function calls `event.preventDefault()` for you. Why is that useful?\n *\n * Beacuase if you enable `window.preventDefaultLogging = true` it'll log out a message when it\n * happens. Because we use console.warn rather than (log) you'll get a stack trace in the inspector\n * telling you exactly where it happened. This is important because `e.preventDefault()` is the\n * source of many bugs, but unfortuantly it can't be avoided because it also stops a lot of default\n * behaviour which doesn't make sense in our UI\n *\n * @param event - To prevent default on\n * @public\n */\nexport function preventDefault(event: React.BaseSyntheticEvent | Event) {\n\tevent.preventDefault()\n\tif (debugFlags.preventDefaultLogging.value) {\n\t\tconsole.warn('preventDefault called on event:', event)\n\t}\n}\n\n/** @public */\nexport function setPointerCapture(\n\telement: Element,\n\tevent: React.PointerEvent<Element> | PointerEvent\n) {\n\telement.setPointerCapture(event.pointerId)\n\tif (debugFlags.pointerCaptureTracking.value) {\n\t\tconst trackingObj = debugFlags.pointerCaptureTrackingObject.value\n\t\ttrackingObj.set(element, (trackingObj.get(element) ?? 0) + 1)\n\t}\n\tif (debugFlags.pointerCaptureLogging.value) {\n\t\tconsole.warn('setPointerCapture called on element:', element, event)\n\t}\n}\n\n/** @public */\nexport function releasePointerCapture(\n\telement: Element,\n\tevent: React.PointerEvent<Element> | PointerEvent\n) {\n\tif (!element.hasPointerCapture(event.pointerId)) {\n\t\treturn\n\t}\n\n\telement.releasePointerCapture(event.pointerId)\n\tif (debugFlags.pointerCaptureTracking.value) {\n\t\tconst trackingObj = debugFlags.pointerCaptureTrackingObject.value\n\t\tif (trackingObj.get(element) === 1) {\n\t\t\ttrackingObj.delete(element)\n\t\t} else if (trackingObj.has(element)) {\n\t\t\ttrackingObj.set(element, trackingObj.get(element)! - 1)\n\t\t} else {\n\t\t\tconsole.warn('Release without capture')\n\t\t}\n\t}\n\tif (debugFlags.pointerCaptureLogging.value) {\n\t\tconsole.warn('releasePointerCapture called on element:', element, event)\n\t}\n}\n\nexport const ROTATING_BOX_SHADOWS = [\n\t{\n\t\toffsetX: 0,\n\t\toffsetY: 2,\n\t\tblur: 4,\n\t\tspread: 0,\n\t\tcolor: '#00000029',\n\t},\n\t{\n\t\toffsetX: 0,\n\t\toffsetY: 3,\n\t\tblur: 6,\n\t\tspread: 0,\n\t\tcolor: '#0000001f',\n\t},\n]\n\n/** @public */\nexport function getRotatedBoxShadow(rotation: number) {\n\tconst cssStrings = ROTATING_BOX_SHADOWS.map((shadow) => {\n\t\tconst { offsetX, offsetY, blur, spread, color } = shadow\n\t\tconst vec = new Vec2d(offsetX, offsetY)\n\t\tconst { x, y } = vec.rot(-rotation)\n\t\treturn `${x}px ${y}px ${blur}px ${spread}px ${color}`\n\t})\n\treturn cssStrings.join(', ')\n}\n\n/** @public */\nexport function usePrefersReducedMotion() {\n\tconst [prefersReducedMotion, setPrefersReducedMotion] = useState(false)\n\n\tuseEffect(() => {\n\t\tconst mql = window.matchMedia('(prefers-reduced-motion: reduce)')\n\t\tconst handler = () => {\n\t\t\tsetPrefersReducedMotion(mql.matches)\n\t\t}\n\t\thandler()\n\t\tmql.addEventListener('change', handler)\n\t\treturn () => mql.removeEventListener('change', handler)\n\t}, [])\n\n\treturn prefersReducedMotion\n}\n\n/** @public */\nexport const truncateStringWithEllipsis = (str: string, maxLength: number) => {\n\treturn str.length <= maxLength ? str : str.substring(0, maxLength - 3) + '...'\n}\n\nexport const stopEventPropagation = (e: any) => e.stopPropagation()\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAeA,wBAAsB;AACtB,mBAA2C;AAC3C,yBAA2B;AAGpB,SAAS,kBAAkB,KAA2B;AAC5D,MAAI,eAAe;AAAa,WAAO;AACvC,MAAI,IAAI;AAAe,WAAO,kBAAkB,IAAI,aAAa;AAAA;AAC5D,UAAM,MAAM,kDAAkD;AACpE;AAcO,SAAS,eAAe,OAAyC;AACvE,QAAM,eAAe;AACrB,MAAI,8BAAW,sBAAsB,OAAO;AAC3C,YAAQ,KAAK,mCAAmC,KAAK;AAAA,EACtD;AACD;AAGO,SAAS,kBACf,SACA,OACC;AACD,UAAQ,kBAAkB,MAAM,SAAS;AACzC,MAAI,8BAAW,uBAAuB,OAAO;AAC5C,UAAM,cAAc,8BAAW,6BAA6B;AAC5D,gBAAY,IAAI,UAAU,YAAY,IAAI,OAAO,KAAK,KAAK,CAAC;AAAA,EAC7D;AACA,MAAI,8BAAW,sBAAsB,OAAO;AAC3C,YAAQ,KAAK,wCAAwC,SAAS,KAAK;AAAA,EACpE;AACD;AAGO,SAAS,sBACf,SACA,OACC;AACD,MAAI,CAAC,QAAQ,kBAAkB,MAAM,SAAS,GAAG;AAChD;AAAA,EACD;AAEA,UAAQ,sBAAsB,MAAM,SAAS;AAC7C,MAAI,8BAAW,uBAAuB,OAAO;AAC5C,UAAM,cAAc,8BAAW,6BAA6B;AAC5D,QAAI,YAAY,IAAI,OAAO,MAAM,GAAG;AACnC,kBAAY,OAAO,OAAO;AAAA,IAC3B,WAAW,YAAY,IAAI,OAAO,GAAG;AACpC,kBAAY,IAAI,SAAS,YAAY,IAAI,OAAO,IAAK,CAAC;AAAA,IACvD,OAAO;AACN,cAAQ,KAAK,yBAAyB;AAAA,IACvC;AAAA,EACD;AACA,MAAI,8BAAW,sBAAsB,OAAO;AAC3C,YAAQ,KAAK,4CAA4C,SAAS,KAAK;AAAA,EACxE;AACD;AAEO,MAAM,uBAAuB;AAAA,EACnC;AAAA,IACC,SAAS;AAAA,IACT,SAAS;AAAA,IACT,MAAM;AAAA,IACN,QAAQ;AAAA,IACR,OAAO;AAAA,EACR;AAAA,EACA;AAAA,IACC,SAAS;AAAA,IACT,SAAS;AAAA,IACT,MAAM;AAAA,IACN,QAAQ;AAAA,IACR,OAAO;AAAA,EACR;AACD;AAGO,SAAS,oBAAoB,UAAkB;AACrD,QAAM,aAAa,qBAAqB,IAAI,CAAC,WAAW;AACvD,UAAM,EAAE,SAAS,SAAS,MAAM,QAAQ,MAAM,IAAI;AAClD,UAAM,MAAM,IAAI,wBAAM,SAAS,OAAO;AACtC,UAAM,EAAE,GAAG,EAAE,IAAI,IAAI,IAAI,CAAC,QAAQ;AAClC,WAAO,GAAG,OAAO,OAAO,UAAU,YAAY;AAAA,EAC/C,CAAC;AACD,SAAO,WAAW,KAAK,IAAI;AAC5B;AAGO,SAAS,0BAA0B;AACzC,QAAM,CAAC,sBAAsB,uBAAuB,QAAI,uBAAS,KAAK;AAEtE,8BAAU,MAAM;AACf,UAAM,MAAM,OAAO,WAAW,kCAAkC;AAChE,UAAM,UAAU,MAAM;AACrB,8BAAwB,IAAI,OAAO;AAAA,IACpC;AACA,YAAQ;AACR,QAAI,iBAAiB,UAAU,OAAO;AACtC,WAAO,MAAM,IAAI,oBAAoB,UAAU,OAAO;AAAA,EACvD,GAAG,CAAC,CAAC;AAEL,SAAO;AACR;AAGO,MAAM,6BAA6B,CAAC,KAAa,cAAsB;AAC7E,SAAO,IAAI,UAAU,YAAY,MAAM,IAAI,UAAU,GAAG,YAAY,CAAC,IAAI;AAC1E;AAEO,MAAM,uBAAuB,CAAC,MAAW,EAAE,gBAAgB;",
  "names": []
}
